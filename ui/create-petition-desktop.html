<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SpeakUp! ‚Äî Buat Aspirasi (Desktop)</title>
  <link rel="icon" type="image/png" href="assets/logo/logo apps.png?v=2">
  <link rel="shortcut icon" type="image/png" href="assets/logo/logo apps.png?v=2">
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    :root { --bg:#ffffff; --panel:#ffffff; --text:#374151; --muted:#64748b; --accent:#38bdf8; --border:#e5e7eb; }
    .logo img[data-theme="light"]{display:block!important}.logo img[data-theme="dark"]{display:none!important}
    html,body,main,.desktop-container,.desktop-nav,.card,.tabs .tab,.modal .box{background:#ffffff!important}
    body{margin:0;padding:0;min-height:100vh;background:#ffffff!important;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
    .desktop-nav{display:block!important}
    .desktop-container{max-width:1024px;margin:0 auto;padding:24px 32px}
    .desktop-nav .nav-item.active{background:#ffffff!important;color:#374151!important;border:1px solid #e5e7eb!important}
    .desktop-nav .nav-item.plus-btn,.btn.primary{background:#ffffff!important;color:#374151!important;border:1px solid #e5e7eb!important}
    body.desktop-page, body.desktop-page *:not(h1):not(h2):not(h3):not(h4):not(h5):not(h6){color:#374151!important}
    
    .form-container { max-width: 800px; margin: 0 auto; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    .form-section { margin-bottom: 32px; }
    .file-upload-container { margin-top: 8px; }
    .upload-btn { width: 100%; justify-content: center; gap: 8px; }
    .image-preview { margin-top: 12px; display: none; }
    .image-preview.show { display: block; }
    .image-preview img { max-width: 200px; max-height: 150px; border-radius: 8px; }
    .remove-btn { margin-top: 8px; }
    #photosList { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    #documentsList { margin-bottom: 12px; }
    .checkbox-group { display: flex; flex-direction: column; gap: 16px; }
    .checkbox-item { display: flex; align-items: flex-start; gap: 12px; }
    .checkbox-item input[type="checkbox"] { margin-top: 4px; }
    .checkbox-item span { line-height: 1.5; }
    
    /* Signature Canvas Styles - Ensure same size as settings */
    #signatureCanvas {
      width: 500px !important;
      height: 200px !important;
      max-width: 500px !important;
      min-width: 500px !important;
    }
    
    .signature-container {
      min-width: 500px !important;
      max-width: 500px !important;
    }
  </style>
</head>
<body class="desktop-page">
  <div class="desktop-container">
    <nav class="desktop-nav" aria-label="Navigasi desktop">
      <div class="desktop-nav-inner">
        <div class="nav-left">
          <div class="logo">SpeakUp!</div>
          <button class="nav-item plus-btn" data-open-create title="Speak!">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
            </svg>
            <span>Speak!</span>
          </button>
          <a href="./desktop.html" class="nav-item" title="Home">
            <svg fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg>
            <span>Home</span>
          </a>
          <a href="./timeline-desktop.html" class="nav-item" title="Timeline">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
            <span>Timeline</span>
          </a>
          <a href="./petitions-desktop.html" class="nav-item active" title="Aspirasi">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>
            <span>Aspirasi</span>
          </a>
        </div>
        <div class="nav-right">
          <a href="./settings-desktop.html" class="nav-item" title="Settings">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/></svg>
            <span>Settings</span>
          </a>
          <a href="./profile-desktop.html" class="nav-item" title="Profile">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>
            <span>Profile</span>
          </a>
          <a href="./sign-desktop.html" class="nav-item" id="signButton" title="Login">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 10a1 1 0 011-1h8.586l-3.293-3.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 11-1.414-1.414L12.586 11H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>
            <span>Login</span>
          </a>
        </div>
      </div>
    </nav>

    <main>
      <section class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <h1>Yuk, Suarakan Aspirasimu!</h1>
          <a href="./petitions-desktop.html" class="btn ghost">‚Üê Kembali ke Aspirasi</a>
        </div>
        
        <p style="color: var(--muted); margin-bottom: 32px; font-size: 16px;">
          Ceritakan masalahmu dan mari kita buat perubahan bersama-sama
        </p>

        <div class="form-container">
          <form id="createPetitionForm">
            <!-- Step 1: Ceritakan Masalahmu -->
            <div class="form-section">
              <div class="card" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border: none;">
                <h3 style="margin-bottom: 12px; color: #1e293b; font-size: 20px;">Ceritakan Masalahmu</h3>
                <p style="color: var(--muted); font-size: 14px; margin-bottom: 24px;">Jangan khawatir, kita akan bantu kamu menyuarakan ini!</p>
                
                <div class="form-grid">
                  <div>
                    <label style="font-weight: 500; color: #374151;">Apa masalah yang ingin kamu angkat?</label>
                    <input type="text" name="title" required maxlength="100" placeholder="Misal: Stop bullying di sekolahku!" style="margin-top: 8px;">
                  </div>
                  
                  <div>
                    <label style="font-weight: 500; color: #374151;">Kategori masalah</label>
                    <select name="category" required style="margin-top: 8px;">
                      <option value="">Pilih kategori yang paling sesuai</option>
                      <option value="bullying">Bullying/Perundungan</option>
                      <option value="workplace">Masalah di Tempat Kerja</option>
                      <option value="education">Pendidikan</option>
                      <option value="discrimination">Diskriminasi</option>
                      <option value="corruption">Korupsi</option>
                      <option value="environment">Lingkungan</option>
                      <option value="other">Lainnya</option>
                    </select>
                  </div>
                </div>

                <div class="mt-16">
                  <label style="font-weight: 500; color: #374151;">Ceritakan kronologi masalahnya</label>
                  <div style="position: relative; margin-top: 8px;">
                    <textarea name="description" id="descriptionText" rows="5" required maxlength="2000" placeholder="Ceritakan apa yang terjadi, kapan, dimana, dan bagaimana dampaknya ke kamu atau orang lain..." style="
                      width: 100%;
                      min-height: 120px;
                      padding: 12px 40px 12px 12px;
                      border: 1px solid #d1d5db;
                      border-radius: 8px;
                      resize: vertical;
                      font-family: inherit;
                      font-size: 14px;
                      outline: none;
                      transition: border-color 0.2s;
                    " onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'"></textarea>
                    <button type="button" onclick="toggleEmojiPicker()" style="
                      position: absolute;
                      right: 8px;
                      bottom: 8px;
                      background: none;
                      border: none;
                      font-size: 18px;
                      cursor: pointer;
                      padding: 4px;
                      border-radius: 4px;
                      transition: background-color 0.2s;
                    " onmouseover="this.style.backgroundColor='#f3f4f6'" onmouseout="this.style.backgroundColor='transparent'" title="Pilih Emoji">
                      üòä
                    </button>
                    
                    <!-- Emoji Picker untuk Deskripsi -->
                    <div id="descriptionEmojiPicker" style="
                      position: absolute;
                      bottom: 50px;
                      right: 0;
                      background: #ffffff;
                      border: 1px solid #e5e7eb;
                      border-radius: 8px;
                      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                      padding: 12px;
                      z-index: 1000;
                      max-width: 200px;
                      display: none;
                    ">
                      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                        <button type="button" onclick="insertEmoji('üòä')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üòä</button>
                        <button type="button" onclick="insertEmoji('üò¢')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üò¢</button>
                        <button type="button" onclick="insertEmoji('üò°')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üò°</button>
                        <button type="button" onclick="insertEmoji('üòç')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üòç</button>
                        <button type="button" onclick="insertEmoji('ü§î')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">ü§î</button>
                        <button type="button" onclick="insertEmoji('üòÆ')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üòÆ</button>
                        <button type="button" onclick="insertEmoji('üò≠')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üò≠</button>
                        <button type="button" onclick="insertEmoji('üò§')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üò§</button>
                        <button type="button" onclick="insertEmoji('üôè')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üôè</button>
                        <button type="button" onclick="insertEmoji('‚ù§Ô∏è')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">‚ù§Ô∏è</button>
                        <button type="button" onclick="insertEmoji('üëç')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üëç</button>
                        <button type="button" onclick="insertEmoji('üëé')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üëé</button>
                        <button type="button" onclick="insertEmoji('üî•')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üî•</button>
                        <button type="button" onclick="insertEmoji('üí™')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üí™</button>
                        <button type="button" onclick="insertEmoji('üéâ')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">üéâ</button>
                        <button type="button" onclick="insertEmoji('‚ú®')" style="background: none; border: none; font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">‚ú®</button>
                      </div>
                    </div>
                  </div>
                  <div style="font-size: 12px; color: var(--muted); margin-top: 6px;">Tip: Semakin detail ceritamu, semakin kuat aspirasimu!</div>
                </div>

                <div class="form-grid mt-16">
                  <div>
                    <label style="font-weight: 500; color: #374151;">Siapa yang bisa menyelesaikan masalah ini?</label>
                    <input type="text" name="target" required placeholder="Misal: Kepala Sekolah, Rektor, Walikota..." style="margin-top: 8px;">
                  </div>
                  
                  <div>
                    <label style="font-weight: 500; color: #374151;">Target tanda tangan (opsional)</label>
                    <input type="number" name="signature_target" min="100" max="100000" placeholder="Misal: 1000 orang" style="margin-top: 8px;">
                  </div>
                </div>

                <div class="mt-16">
                  <label style="font-weight: 500; color: #374151;">Apa solusi yang kamu inginkan?</label>
                  <textarea name="solution" rows="4" required maxlength="1000" placeholder="Misal: Buat kebijakan anti-bullying yang tegas, adakan sosialisasi..." style="margin-top: 8px;"></textarea>
                </div>
              </div>
            </div>

            <!-- Step 2: Verifikasi Diri -->
            <div class="form-section">
              <div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none;">
                <h3 style="margin-bottom: 12px; color: #92400e; font-size: 20px;">Verifikasi Diri</h3>
                <p style="color: #a16207; font-size: 14px; margin-bottom: 24px;">
                  Tenang aja! Data kamu aman dan cuma dipakai untuk verifikasi
                </p>

                <div class="form-grid">
                  <div>
                    <label>Nama Lengkap (sesuai KTP) *</label>
                    <input type="text" name="full_name" required placeholder="Nama lengkap sesuai dokumen identitas">
                  </div>
                  
                  <div>
                    <label>NIK (Nomor Induk Kependudukan) *</label>
                    <input type="text" name="nik" required pattern="[0-9]{16}" maxlength="16" placeholder="16 digit NIK">
                  </div>
                </div>

                <div class="mt-16">
                  <label>Upload Foto KTP/Identitas *</label>
                  <div class="file-upload-container">
                    <input type="file" id="ktpUpload" name="ktp" accept="image/*" required style="display: none;">
                    <button type="button" class="btn ghost upload-btn" onclick="document.getElementById('ktpUpload').click()">
                      <svg fill="currentColor" viewBox="0 0 20 20" width="20" height="20">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                      </svg>
                      Upload Foto KTP
                    </button>
                    <div id="ktpPreview" class="image-preview">
                      <img id="ktpImg">
                      <button type="button" onclick="removeKTP()" class="btn ghost remove-btn">Hapus</button>
                    </div>
                  </div>
                </div>

                <div class="form-grid mt-16">
                  <div>
                    <label>Nomor Telepon *</label>
                    <input type="tel" name="phone" required placeholder="08xxxxxxxxxx">
                  </div>
                  
                  <div>
                    <label>Email *</label>
                    <input type="email" name="email" required placeholder="email@example.com">
                  </div>
                </div>
              </div>
            </div>

            <!-- Step 3: Bukti Pendukung -->
            <div class="form-section">
              <div class="card" style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: none; padding: 24px 28px;">
                <h3 style="margin-bottom: 12px; color: #065f46; font-size: 20px;">Punya Bukti? Upload Yuk!</h3>
                <p style="color: #047857; font-size: 14px; margin-bottom: 24px;">
                  Bukti akan bikin aspirasimu lebih kuat! Tapi gak wajib kok
                </p>

                <div class="form-grid">
                  <div>
                    <label>Foto/Screenshot Bukti</label>
                    <div class="file-upload-container">
                      <input type="file" id="evidencePhotos" name="evidence_photos" accept="image/*" multiple style="display: none;">
                      <button type="button" class="btn ghost upload-btn" onclick="document.getElementById('evidencePhotos').click()">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="20" height="20">
                          <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                        </svg>
                        Upload Foto Bukti (Maks 5 file)
                      </button>
                      <div id="photosPreview" class="image-preview">
                        <div id="photosList"></div>
                        <button type="button" onclick="removePhotos()" class="btn ghost remove-btn" style="display: none;">Hapus Semua</button>
                      </div>
                    </div>
                  </div>
                  
                  <div>
                    <label>Video Bukti (Opsional)</label>
                    <div class="file-upload-container">
                      <input type="file" id="evidenceVideo" name="evidence_video" accept="video/*" style="display: none;">
                      <button type="button" class="btn ghost upload-btn" onclick="document.getElementById('evidenceVideo').click()">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="20" height="20">
                          <path d="M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                        </svg>
                        Upload Video Bukti (Maks 50MB)
                      </button>
                      <div id="videoPreview" class="image-preview">
                        <video id="videoElement" controls style="max-width: 100%; display: none;"></video>
                        <button type="button" onclick="removeVideo()" class="btn ghost remove-btn" style="display: none;">Hapus Video</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mt-16">
                  <label>Dokumen Pendukung (PDF, DOC)</label>
                  <div class="file-upload-container">
                    <input type="file" id="documents" name="documents" accept=".pdf,.doc,.docx" multiple style="display: none;">
                    <button type="button" class="btn ghost upload-btn" onclick="document.getElementById('documents').click()">
                      <svg fill="currentColor" viewBox="0 0 20 20" width="20" height="20">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                      </svg>
                      Upload Dokumen (Maks 3 file)
                    </button>
                    <div id="documentsPreview" class="image-preview">
                      <div id="documentsList"></div>
                      <button type="button" onclick="removeDocuments()" class="btn ghost remove-btn" style="display: none;">Hapus Semua</button>
                    </div>
                  </div>
                </div>

                <div class="mt-16">
                  <label style="font-weight: 500; color: #374151;">Cerita tambahan tentang bukti-bukti ini</label>
                  <textarea name="additional_info" rows="3" maxlength="500" placeholder="Misal: Foto ini diambil saat kejadian, video ini menunjukkan..." style="margin-top: 8px;"></textarea>
                </div>
              </div>
            </div>

            <!-- Step 3.5: Tanda Tangan Digital -->
            <div class="form-section">
              <div class="card" style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); border: none; padding: 24px 28px;">
                <h3 style="margin-bottom: 12px; color: #3730a3; font-size: 20px;">Tanda Tangan Digital</h3>
                <p style="color: #4338ca; font-size: 14px; margin-bottom: 24px;">
                  Buat tanda tangan digitalmu sebagai komitmen atas aspirasi ini!
                </p>

                <div class="mt-16">
                  <label style="font-weight: 500; color: #374151;">Tanda tangan kamu</label>
                  <div style="font-size: 12px; color: var(--muted); margin-bottom: 12px;">Gambar tanda tangan di kotak biru di bawah ini</div>
                  
                  <div style="border: 2px dashed var(--border); border-radius: 8px; padding: 16px; text-align: center; background: var(--bg); margin-top: 12px; position: relative; width: 500px; max-width: 500px; min-width: 500px; overflow: hidden;">
                    <canvas id="signatureCanvas" width="500" height="200" style="display: block; width: 500px; height: 200px; cursor: crosshair; background: white; border-radius: 4px;"></canvas>
                    <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
                      Gambar tanda tangan Anda di atas
                    </div>
                    <div style="margin-top: 8px;">
                      <button type="button" class="btn ghost" onclick="clearSignature()" style="font-size: 12px;">Hapus</button>
                      <button type="button" class="btn ghost" onclick="saveSignature()" style="font-size: 12px;">Simpan</button>
                    </div>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #9ca3af; font-size: 14px; pointer-events: none; text-align: center; z-index: 1;" id="signaturePlaceholder">
                      Gambar tanda tangan di sini
                    </div>
                  </div>
                  
                  
                  <div id="signatureTipsSection" style="margin-top: 16px; padding: 16px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; max-width: 500px;">
                    <div style="font-size: 14px; color: #0369a1; font-weight: 500; margin-bottom: 8px;">üí° Tips</div>
                    <div id="signatureTipsText" style="font-size: 13px; color: #0369a1; margin-bottom: 12px;">
                      Sudah punya tanda tangan digital? Gunakan yang sudah tersimpan!
                    </div>
                    <button type="button" onclick="loadSavedSignature()" class="btn" style="width: 100%; background: #0ea5e9; color: white; border: none; padding: 10px 16px; font-size: 13px; margin-bottom: 8px;">
                      üìù Gunakan Tanda Tangan Tersimpan
                    </button>
                    <button type="button" onclick="loadFromSupabase()" class="btn" style="width: 100%; background: #3b82f6; color: white; border: none; padding: 10px 16px; font-size: 13px; margin-bottom: 8px;">
                      üì• Muat dari Database
                    </button>
                    <button type="button" onclick="debugSignatureStorage()" class="btn" style="width: 100%; background: #f59e0b; color: white; border: none; padding: 10px 16px; font-size: 13px;">
                      üîç Debug Storage
                    </button>
                  </div>
                  
                  <div id="signaturePreview" style="display: none; margin-top: 16px; padding: 16px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; max-width: 500px;">
                    <div style="font-size: 14px; color: #4338ca; margin-bottom: 12px;">Tanda tangan tersimpan:</div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <img id="signatureImage" style="max-width: 80px; max-height: 40px; border: 1px solid #d1d5db; border-radius: 4px; background: white;">
                      <div>
                        <div id="signatureName" style="font-size: 14px; font-weight: 500; color: #374151;"></div>
                        <div id="signatureDate" style="font-size: 11px; color: #6b7280;"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Step 4: Pernyataan dan Konfirmasi -->
            <div class="form-section">
              <div class="card">
                <h3 style="margin-bottom: 24px; color: var(--accent); font-size: 20px;">Pernyataan dan Konfirmasi</h3>
                
                <div class="checkbox-group">
                  <div class="checkbox-item">
                    <input type="checkbox" name="fact_declaration" required id="fact_declaration">
                    <label for="fact_declaration">
                      <span>Saya menyatakan bahwa semua informasi dan bukti yang saya berikan adalah <strong>benar dan faktual</strong>, bukan berdasarkan kepentingan pribadi atau dendam.</span>
                    </label>
                  </div>

                  <div class="checkbox-item">
                    <input type="checkbox" name="responsibility" required id="responsibility">
                    <label for="responsibility">
                      <span>Saya bertanggung jawab penuh atas aspirasi ini dan siap mempertanggungjawabkan secara hukum jika terbukti memberikan informasi palsu.</span>
                    </label>
                  </div>

                  <div class="checkbox-item">
                    <input type="checkbox" name="privacy_consent" required id="privacy_consent">
                    <label for="privacy_consent">
                      <span>Saya memahami bahwa data pribadi saya akan diverifikasi oleh tim SpeakUp! dan dapat dibagikan kepada pihak berwenang jika diperlukan.</span>
                    </label>
                  </div>

                  <div class="checkbox-item">
                    <input type="checkbox" name="terms_agreement" required id="terms_agreement">
                    <label for="terms_agreement">
                      <span>Saya menyetujui <a href="./terms-privacy-desktop.html" style="color: var(--accent);">Syarat dan Ketentuan</a> serta <a href="./terms-privacy-desktop.html" style="color: var(--accent);">Kebijakan Privasi</a> SpeakUp!</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div style="text-align: center; margin: 40px 0;">
              <button type="submit" class="btn primary" style="padding: 16px 48px; font-size: 18px; font-weight: 600;">
                Kirim Aspirasi untuk Verifikasi
              </button>
              <p style="margin-top: 16px; font-size: 14px; color: var(--muted);">
                Aspirasi akan direview dalam 1-3 hari kerja sebelum dipublikasikan
              </p>
            </div>
          </form>
        </div>
      </section>
    </main>

    <script>
      // File upload handlers
      function removeKTP() {
        const ktpUpload = document.getElementById('ktpUpload');
        const ktpPreview = document.getElementById('ktpPreview');
        const ktpImg = document.getElementById('ktpImg');
        
        ktpUpload.value = '';
        ktpPreview.classList.remove('show');
        ktpImg.src = '';
      }

      function removePhotos() {
        const photosUpload = document.getElementById('evidencePhotos');
        const photosList = document.getElementById('photosList');
        const removeBtn = document.querySelector('#photosPreview .remove-btn');
        
        photosUpload.value = '';
        photosList.innerHTML = '';
        removeBtn.style.display = 'none';
      }

      function removeVideo() {
        const videoUpload = document.getElementById('evidenceVideo');
        const videoElement = document.getElementById('videoElement');
        const removeBtn = document.querySelector('#videoPreview .remove-btn');
        
        videoUpload.value = '';
        videoElement.style.display = 'none';
        videoElement.src = '';
        removeBtn.style.display = 'none';
      }

      function removeDocuments() {
        const docsUpload = document.getElementById('documents');
        const docsList = document.getElementById('documentsList');
        const removeBtn = document.querySelector('#documentsPreview .remove-btn');
        
        docsUpload.value = '';
        docsList.innerHTML = '';
        removeBtn.style.display = 'none';
      }

      // KTP upload preview
      document.getElementById('ktpUpload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const ktpImg = document.getElementById('ktpImg');
            const ktpPreview = document.getElementById('ktpPreview');
            ktpImg.src = e.target.result;
            ktpPreview.classList.add('show');
          };
          reader.readAsDataURL(file);
        }
      });

      // Evidence photos upload preview
      document.getElementById('evidencePhotos').addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        const photosList = document.getElementById('photosList');
        const removeBtn = document.querySelector('#photosPreview .remove-btn');
        const photosPreview = document.getElementById('photosPreview');
        
        if (files.length > 5) {
          alert('Maksimal 5 foto yang dapat diupload');
          e.target.value = '';
          return;
        }
        
        photosList.innerHTML = '';
        
        if (files.length > 0) {
          // Show file names and thumbnails
          files.forEach((file, index) => {
            const fileItem = document.createElement('div');
            fileItem.style.cssText = 'display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin: 8px 0; border-left: 3px solid #10b981;';
            
            const reader = new FileReader();
            reader.onload = function(e) {
              const img = document.createElement('img');
              img.src = e.target.result;
              img.style.cssText = 'width: 60px; height: 60px; object-fit: cover; border-radius: 6px; border: 1px solid #d1d5db;';
              
              const fileInfo = document.createElement('div');
              fileInfo.style.cssText = 'flex: 1; font-size: 14px;';
              fileInfo.innerHTML = `
                <div style="font-weight: 500; color: #047857;">${file.name}</div>
                <div style="color: var(--muted); font-size: 12px;">${(file.size / 1024).toFixed(1)} KB</div>
              `;
              
              fileItem.appendChild(img);
              fileItem.appendChild(fileInfo);
              photosList.appendChild(fileItem);
            };
            reader.readAsDataURL(file);
          });
          
          photosPreview.style.display = 'block';
          removeBtn.style.display = 'block';
        } else {
          photosPreview.style.display = 'none';
        }
      });

      // Video upload preview
      document.getElementById('evidenceVideo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const videoPreview = document.getElementById('videoPreview');
        
        if (file) {
          if (file.size > 50 * 1024 * 1024) { // 50MB limit
            alert('Ukuran video maksimal 50MB');
            e.target.value = '';
            return;
          }
          
          // Clear previous content
          videoPreview.innerHTML = '';
          
          // Create main container
          const videoContainer = document.createElement('div');
          videoContainer.style.cssText = 'display: flex; align-items: flex-start; gap: 16px; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 3px solid #10b981;';
          
          // Create video thumbnail container
          const thumbnailContainer = document.createElement('div');
          thumbnailContainer.style.cssText = 'flex-shrink: 0;';
          
          const url = URL.createObjectURL(file);
          const video = document.createElement('video');
          video.src = url;
          video.style.cssText = 'width: 120px; height: 90px; object-fit: cover; border-radius: 8px; border: 1px solid #d1d5db;';
          video.muted = true;
          
          // Create play icon overlay
          const playIcon = document.createElement('div');
          playIcon.style.cssText = 'position: relative; display: inline-block;';
          playIcon.innerHTML = `
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px;">‚ñ∂</div>
          `;
          playIcon.appendChild(video);
          thumbnailContainer.appendChild(playIcon);
          
          // Load video metadata to get thumbnail
          video.addEventListener('loadedmetadata', function() {
            video.currentTime = 1; // Seek to 1 second for thumbnail
          });
          
          // Create file info
          const fileInfo = document.createElement('div');
          fileInfo.style.cssText = 'flex: 1; min-width: 0;';
          fileInfo.innerHTML = `
            <div style="font-weight: 500; color: #047857; font-size: 16px; margin-bottom: 6px;">${file.name}</div>
            <div style="color: var(--muted); font-size: 14px; margin-bottom: 6px;">${(file.size / (1024 * 1024)).toFixed(1)} MB</div>
            <div style="color: var(--muted); font-size: 12px;">Klik untuk memutar video</div>
          `;
          
          // Add click handler to show full video
          thumbnailContainer.addEventListener('click', function() {
            showVideoModal(url, file.name);
          });
          thumbnailContainer.style.cursor = 'pointer';
          
          videoContainer.appendChild(thumbnailContainer);
          videoContainer.appendChild(fileInfo);
          videoPreview.appendChild(videoContainer);
          
          // Add remove button
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.onclick = removeVideo;
          removeBtn.className = 'btn ghost remove-btn';
          removeBtn.style.cssText = 'margin-top: 12px; width: 100%;';
          removeBtn.textContent = 'Hapus Video';
          videoPreview.appendChild(removeBtn);
          
          videoPreview.style.display = 'block';
        }
      });

      // Documents upload preview
      document.getElementById('documents').addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        const docsList = document.getElementById('documentsList');
        const removeBtn = document.querySelector('#documentsPreview .remove-btn');
        const documentsPreview = document.getElementById('documentsPreview');
        
        if (files.length > 3) {
          alert('Maksimal 3 dokumen yang dapat diupload');
          e.target.value = '';
          return;
        }
        
        docsList.innerHTML = '';
        
        if (files.length > 0) {
          files.forEach((file, index) => {
            const fileDiv = document.createElement('div');
            fileDiv.style.cssText = 'display: flex; align-items: center; gap: 16px; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin: 12px 0; border-left: 3px solid #10b981; cursor: pointer; transition: all 0.2s;';
            
            // Create file icon with better styling
            const fileIcon = document.createElement('div');
            const extension = file.name.split('.').pop().toUpperCase();
            let iconColor = '#10b981';
            let iconEmoji = 'üìÑ';
            
            // Different colors and icons for different file types
            if (extension === 'PDF') {
              iconColor = '#dc2626';
              iconEmoji = 'üìï';
            } else if (extension === 'DOC' || extension === 'DOCX') {
              iconColor = '#38bdf8';
              iconEmoji = 'üìò';
            } else if (extension === 'XLS' || extension === 'XLSX') {
              iconColor = '#059669';
              iconEmoji = 'üìó';
            } else if (extension === 'PPT' || extension === 'PPTX') {
              iconColor = '#ea580c';
              iconEmoji = 'üìô';
            }
            
            fileIcon.style.cssText = `width: 60px; height: 60px; background: ${iconColor}; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold; flex-shrink: 0;`;
            fileIcon.innerHTML = `
              <div style="font-size: 20px; margin-bottom: 4px;">${iconEmoji}</div>
              <div>${extension}</div>
            `;
            
            const fileInfo = document.createElement('div');
            fileInfo.style.cssText = 'flex: 1; min-width: 0;';
            
            // Get file type description
            let fileTypeDesc = 'Dokumen';
            if (extension === 'PDF') fileTypeDesc = 'PDF Document';
            else if (extension === 'DOC' || extension === 'DOCX') fileTypeDesc = 'Word Document';
            else if (extension === 'XLS' || extension === 'XLSX') fileTypeDesc = 'Excel Spreadsheet';
            else if (extension === 'PPT' || extension === 'PPTX') fileTypeDesc = 'PowerPoint Presentation';
            
            fileInfo.innerHTML = `
              <div style="font-weight: 500; color: #047857; font-size: 16px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${file.name}</div>
              <div style="color: var(--muted); font-size: 14px; margin-bottom: 4px;">${fileTypeDesc}</div>
              <div style="color: var(--muted); font-size: 12px;">${(file.size / 1024).toFixed(1)} KB ‚Ä¢ Klik untuk info lebih</div>
            `;
            
            // Add hover effect
            fileDiv.addEventListener('mouseenter', function() {
              this.style.background = 'rgba(16, 185, 129, 0.15)';
              this.style.transform = 'translateY(-2px)';
            });
            
            fileDiv.addEventListener('mouseleave', function() {
              this.style.background = 'rgba(16, 185, 129, 0.1)';
              this.style.transform = 'translateY(0)';
            });
            
            // Add click handler to show file info
            fileDiv.addEventListener('click', function() {
              showDocumentInfo(file, extension, iconEmoji, iconColor);
            });
            
            fileDiv.appendChild(fileIcon);
            fileDiv.appendChild(fileInfo);
            docsList.appendChild(fileDiv);
          });
          
          documentsPreview.style.display = 'block';
          removeBtn.style.display = 'block';
        } else {
          documentsPreview.style.display = 'none';
        }
      });

      // Form submission
      document.getElementById('createPetitionForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Check if user is logged in
        const isLoggedIn = localStorage.getItem('speakup_logged_in');
        if (!isLoggedIn) {
          alert('Anda harus login terlebih dahulu untuk membuat aspirasi. Silakan login di halaman utama.');
          window.location.href = './desktop.html';
          return;
        }
        
        const formData = new FormData(this);
        
        // Validation
        const requiredFields = ['title', 'description', 'target', 'solution', 'category', 'full_name', 'nik', 'phone', 'email'];
        const missingFields = requiredFields.filter(field => !formData.get(field));
        
        if (missingFields.length > 0) {
          alert('Mohon lengkapi semua field yang wajib diisi');
          return;
        }
        
        if (!formData.get('ktp')) {
          alert('Upload foto KTP wajib dilakukan');
          return;
        }
        
        if (!signatureData) {
          alert('Mohon buat tanda tangan digital terlebih dahulu!');
          document.getElementById('signatureCanvas').scrollIntoView({ behavior: 'smooth' });
          return;
        }
        
        // Show loading state
        const submitButton = this.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        submitButton.textContent = 'Mengirim Aspirasi...';
        submitButton.disabled = true;
        
        try {
          // Prepare petition data
          const petitionData = {
            title: formData.get('title'),
            description: formData.get('description'),
            category: formData.get('category'),
            target: formData.get('target'),
            solution: formData.get('solution'),
            signature_target: parseInt(formData.get('signature_target')) || 100,
            full_name: formData.get('full_name'),
            nik: formData.get('nik'),
            phone: formData.get('phone'),
            email: formData.get('email'),
            additional_info: formData.get('additional_info'),
            digital_signature: signatureData,
            ktp_file: formData.get('ktp'),
            evidence_photos: formData.getAll('evidence_photos'),
            evidence_video: formData.get('evidence_video'),
            documents: formData.getAll('documents')
          };
          
          // Validate data
          if (window.petitionsAPI && window.petitionsAPI.validatePetitionData) {
            const validation = window.petitionsAPI.validatePetitionData(petitionData);
            if (!validation.isValid) {
              alert('Data tidak valid:\n' + validation.errors.join('\n'));
              return;
            }
          }
          
          // Create petition
          const result = await window.petitionsAPI.createPetition(petitionData);
          
          // Show success message
          showSuccessModal(result);
          
        } catch (error) {
          console.error('Error creating petition:', error);
          alert('Gagal membuat aspirasi: ' + error.message);
        } finally {
          // Reset button state
          submitButton.textContent = originalText;
          submitButton.disabled = false;
        }
      });

      function showPetitionPreview(formData) {
        // Create modal for preview
        const modal = document.createElement('div');
        modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 40px;';
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = 'background: white; border-radius: 12px; max-width: 800px; max-height: 90vh; overflow-y: auto; width: 100%;';
        
        const today = new Date();
        const dateStr = today.toLocaleDateString('id-ID', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });
        
        modalContent.innerHTML = `
          <div style="padding: 32px;">
            <div style="text-align: center; margin-bottom: 32px;">
              <h2 style="color: #1e293b; margin-bottom: 12px; font-size: 24px;">Preview Aspirasi</h2>
              <p style="color: var(--muted); font-size: 16px;">Pastikan semua informasi sudah benar sebelum dikirim</p>
            </div>
            
            <div style="background: #f8fafc; border: 1px solid var(--border); border-radius: 12px; padding: 32px; font-family: 'Times New Roman', serif;">
              <div style="text-align: center; margin-bottom: 32px;">
                <h3 style="margin: 0; font-size: 20px; font-weight: 600;">PETISI MASYARAKAT</h3>
                <p style="margin: 8px 0; font-size: 16px; font-weight: 500;">${formData.get('title')}</p>
                <p style="margin: 4px 0; font-size: 14px; color: var(--muted);">${dateStr}</p>
              </div>
              
              <div style="margin-bottom: 24px;">
                <p style="font-size: 16px;"><strong>Kepada Yth.</strong><br>
                ${formData.get('target')}</p>
              </div>
              
              <div style="line-height: 1.7; margin-bottom: 32px; font-size: 15px;">
                <p>Dengan hormat,</p>
                
                <p>Saya, ${formData.get('full_name')}, dengan ini menyampaikan aspirasi terkait masalah berikut:</p>
                
                <p><strong>Deskripsi Masalah:</strong><br>
                ${formData.get('description')}</p>
                
                <p><strong>Solusi yang Diharapkan:</strong><br>
                ${formData.get('solution')}</p>
                
                ${formData.get('additional_info') ? `<p><strong>Informasi Tambahan:</strong><br>${formData.get('additional_info')}</p>` : ''}
                
                <p>Demikian aspirasi ini saya sampaikan dengan harapan dapat ditindaklanjuti segera.</p>
                
                <p>Hormat saya,<br>
                <strong>${formData.get('full_name')}</strong><br>
                ${formData.get('phone')} | ${formData.get('email')}</p>
              </div>
              
              ${signatureData ? `
              <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                <p style="font-size: 14px; color: var(--muted); margin-bottom: 12px;">Tanda Tangan Digital:</p>
                <img src="${signatureData}" style="max-width: 200px; border: 1px solid var(--border); border-radius: 6px;">
              </div>
              ` : ''}
            </div>
            
            <div style="margin-top: 32px; display: flex; gap: 16px; justify-content: center;">
              <button onclick="closePetitionPreview()" class="btn ghost" style="padding: 14px 24px; font-size: 16px;">
                ‚Üê Kembali Edit
              </button>
              <button onclick="submitPetition()" class="btn primary" style="padding: 14px 32px; font-size: 16px; background: #10b981; color: white; border: none;">
                Kirim Aspirasi!
              </button>
            </div>
          </div>
        `;
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Store modal reference
        window.currentModal = modal;
      }

      function closePetitionPreview() {
        if (window.currentModal) {
          document.body.removeChild(window.currentModal);
          window.currentModal = null;
        }
      }

      function showSuccessModal(petitionResult) {
        // Create success modal
        const modal = document.createElement('div');
        modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 40px;';
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = 'background: white; border-radius: 12px; max-width: 500px; width: 100%; text-align: center; padding: 40px;';
        
        modalContent.innerHTML = `
          <div style="font-size: 64px; margin-bottom: 20px; color: #10b981;">‚úì</div>
          <h2 style="color: #1e293b; margin-bottom: 16px; font-size: 24px;">Aspirasi Berhasil Dikirim!</h2>
          <p style="color: var(--muted); margin-bottom: 24px; line-height: 1.6;">
            Terima kasih telah berani menyuarakan aspirasimu!<br>
            Tim kami akan mereview aspirasimu dalam 1-3 hari kerja.<br>
            Kamu akan mendapat notifikasi via email.
          </p>
          <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
            <div style="font-size: 14px; color: #0369a1; font-weight: 500;">ID Aspirasi: ${petitionResult.id}</div>
            <div style="font-size: 12px; color: #0369a1; margin-top: 4px;">Simpan ID ini untuk referensi</div>
          </div>
          <div style="display: flex; gap: 12px; justify-content: center;">
            <button onclick="closeSuccessModal()" class="btn primary" style="padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 500;">
              Selesai
            </button>
            <button onclick="viewMyPetitions()" class="btn ghost" style="padding: 12px 24px; border: 1px solid #e5e7eb; border-radius: 8px; background: white; color: #374151;">
              Lihat Aspirasiku
            </button>
          </div>
        `;
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Store modal reference
        window.currentSuccessModal = modal;
      }
      
      function closeSuccessModal() {
        if (window.currentSuccessModal) {
          document.body.removeChild(window.currentSuccessModal);
          window.currentSuccessModal = null;
        }
        
        // Redirect back to petitions page
        window.location.href = './petitions-desktop.html';
      }
      
      function viewMyPetitions() {
        closeSuccessModal();
        // Redirect to user's petitions (bisa dibuat halaman khusus atau filter di petitions page)
        window.location.href = './petitions-desktop.html?my=true';
      }

      // Function to show video in modal
      function showVideoModal(videoUrl, fileName) {
        const modal = document.createElement('div');
        modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 40px;';
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = 'background: white; border-radius: 12px; padding: 32px; max-width: 90vw; max-height: 90vh;';
        
        modalContent.innerHTML = `
          <div style="text-align: center; margin-bottom: 24px;">
            <h3 style="margin: 0; color: #1e293b; font-size: 20px;">${fileName}</h3>
          </div>
          <video controls style="max-width: 100%; max-height: 70vh; border-radius: 8px;">
            <source src="${videoUrl}" type="video/mp4">
            Browser Anda tidak mendukung video.
          </video>
          <div style="text-align: center; margin-top: 24px;">
            <button onclick="closeVideoModal()" class="btn ghost" style="padding: 12px 24px;">Tutup</button>
          </div>
        `;
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        window.currentVideoModal = modal;
        
        // Close on background click
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            closeVideoModal();
          }
        });
      }

      function closeVideoModal() {
        if (window.currentVideoModal) {
          document.body.removeChild(window.currentVideoModal);
          window.currentVideoModal = null;
        }
      }

      // Function to show document info
      function showDocumentInfo(file, extension, iconEmoji, iconColor) {
        const modal = document.createElement('div');
        modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 40px;';
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = 'background: white; border-radius: 12px; padding: 32px; max-width: 500px; width: 100%;';
        
        // Get file type description
        let fileTypeDesc = 'Dokumen';
        let fileTypeDetail = 'File dokumen umum';
        if (extension === 'PDF') {
          fileTypeDesc = 'PDF Document';
          fileTypeDetail = 'Portable Document Format - dapat dibuka di semua perangkat';
        } else if (extension === 'DOC' || extension === 'DOCX') {
          fileTypeDesc = 'Word Document';
          fileTypeDetail = 'Microsoft Word document - untuk teks dan formatting';
        } else if (extension === 'XLS' || extension === 'XLSX') {
          fileTypeDesc = 'Excel Spreadsheet';
          fileTypeDetail = 'Microsoft Excel spreadsheet - untuk data dan kalkulasi';
        } else if (extension === 'PPT' || extension === 'PPTX') {
          fileTypeDesc = 'PowerPoint Presentation';
          fileTypeDetail = 'Microsoft PowerPoint presentation - untuk slide presentasi';
        }
        
        const lastModified = new Date(file.lastModified).toLocaleDateString('id-ID', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        modalContent.innerHTML = `
          <div style="text-align: center; margin-bottom: 24px;">
            <div style="width: 80px; height: 80px; background: ${iconColor}; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: bold; margin: 0 auto 16px;">
              <div style="font-size: 32px; margin-bottom: 4px;">${iconEmoji}</div>
              <div>${extension}</div>
            </div>
            <h3 style="margin: 0; color: #1e293b; font-size: 20px;">Informasi Dokumen</h3>
          </div>
          
          <div style="space-y: 16px;">
            <div style="margin-bottom: 16px;">
              <div style="font-size: 14px; color: var(--muted); margin-bottom: 6px;">Nama File:</div>
              <div style="font-weight: 500; color: #374151; word-break: break-all; font-size: 16px;">${file.name}</div>
            </div>
            
            <div style="margin-bottom: 16px;">
              <div style="font-size: 14px; color: var(--muted); margin-bottom: 6px;">Tipe File:</div>
              <div style="font-weight: 500; color: #374151; font-size: 16px;">${fileTypeDesc}</div>
              <div style="font-size: 13px; color: var(--muted);">${fileTypeDetail}</div>
            </div>
            
            <div style="margin-bottom: 16px;">
              <div style="font-size: 14px; color: var(--muted); margin-bottom: 6px;">Ukuran File:</div>
              <div style="font-weight: 500; color: #374151; font-size: 16px;">${(file.size / 1024).toFixed(1)} KB</div>
            </div>
            
            <div style="margin-bottom: 24px;">
              <div style="font-size: 14px; color: var(--muted); margin-bottom: 6px;">Terakhir Dimodifikasi:</div>
              <div style="font-weight: 500; color: #374151; font-size: 16px;">${lastModified}</div>
            </div>
          </div>
          
          <div style="text-align: center;">
            <button onclick="closeDocumentModal()" class="btn primary" style="padding: 12px 24px;">Tutup</button>
          </div>
        `;
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        window.currentDocumentModal = modal;
        
        // Close on background click
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            closeDocumentModal();
          }
        });
      }

      function closeDocumentModal() {
        if (window.currentDocumentModal) {
          document.body.removeChild(window.currentDocumentModal);
          window.currentDocumentModal = null;
        }
      }

      // NIK input validation
      document.querySelector('input[name="nik"]').addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
      });

      // Phone input validation
      document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
      });

      // Digital Signature functionality
      let isDrawing = false;
      let signatureData = null;
      const canvas = document.getElementById('signatureCanvas');
      const ctx = canvas.getContext('2d');
      const placeholder = document.getElementById('signaturePlaceholder');

      // Set canvas size properly (same as settings)
      function resizeCanvas() {
        // Use exact same size as settings - no High DPI scaling
        canvas.width = 500;
        canvas.height = 200;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.strokeStyle = '#1f2937';
        ctx.lineWidth = 2;
      }

      resizeCanvas();
      
      // Check for saved signature on page load
      checkForSavedSignature();

      // Mouse events
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);

      // Touch events for mobile
      canvas.addEventListener('touchstart', handleTouch);
      canvas.addEventListener('touchmove', handleTouch);
      canvas.addEventListener('touchend', stopDrawing);

      function startDrawing(e) {
        isDrawing = true;
        placeholder.style.display = 'none';
        const rect = canvas.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(
          (e.clientX - rect.left) * (canvas.width / rect.width),
          (e.clientY - rect.top) * (canvas.height / rect.height)
        );
      }

      function draw(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        ctx.lineTo(
          (e.clientX - rect.left) * (canvas.width / rect.width),
          (e.clientY - rect.top) * (canvas.height / rect.height)
        );
        ctx.stroke();
      }

      function stopDrawing() {
        isDrawing = false;
        ctx.beginPath();
      }

      function handleTouch(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                         e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
          clientX: touch.clientX,
          clientY: touch.clientY
        });
        canvas.dispatchEvent(mouseEvent);
      }

      function clearSignature() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        placeholder.style.display = 'block';
        document.getElementById('signaturePreview').style.display = 'none';
        signatureData = null;
        
        // Also remove from localStorage
        localStorage.removeItem('userSignature');
        localStorage.removeItem('userFullName');
        console.log('‚úÖ Tanda tangan dihapus dari memory dan localStorage');
      }

      function saveSignature() {
        if (isCanvasEmpty()) {
          alert('Mohon buat tanda tangan terlebih dahulu!');
          return;
        }
        
        // Save with high quality to preserve signature details
        signatureData = canvas.toDataURL('image/png', 1.0);
        document.getElementById('signatureImage').src = signatureData;
        document.getElementById('signaturePreview').style.display = 'block';
        
        // Also save to localStorage for future use
        localStorage.setItem('userSignature', signatureData);
        console.log('‚úÖ Tanda tangan disimpan ke localStorage');
        
        // Update name and date for new signature
        const signatureName = document.getElementById('signatureName');
        const signatureDate = document.getElementById('signatureDate');
        if (signatureName) {
          signatureName.textContent = 'Tanda Tangan Baru';
        }
        if (signatureDate) {
          const now = new Date();
          signatureDate.textContent = `Dibuat: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}`;
        }
        
        // Show success message
        const preview = document.getElementById('signaturePreview');
        preview.style.background = 'rgba(34, 197, 94, 0.1)';
        preview.style.borderLeft = '4px solid #22c55e';
        
        setTimeout(() => {
          preview.style.background = 'rgba(99, 102, 241, 0.1)';
          preview.style.borderLeft = 'none';
        }, 2000);
        
        alert('‚úÖ Tanda tangan berhasil disimpan! Sekarang bisa digunakan di halaman lain.');
      }

      function isCanvasEmpty() {
        const blank = document.createElement('canvas');
        blank.width = canvas.width;
        blank.height = canvas.height;
        return canvas.toDataURL() === blank.toDataURL();
      }

      // Load saved signature from Supabase (with localStorage fallback)
      async function loadSavedSignature() {
        try {
          console.log('üîÑ Loading saved signature...');
          
          // First try to load from Supabase
          const supabase = window.getSupabase();
          if (supabase) {
            console.log('üîÑ Mencoba memuat dari Supabase...');
            
            const { data, error } = await supabase.rpc('get_user_signature');
            
            if (!error && data && data.signature_data) {
              console.log('‚úÖ Tanda tangan ditemukan di Supabase:', data);
              
              // Load signature to canvas
              const img = new Image();
              img.onload = function() {
                canvas.width = 500;
                canvas.height = 200;
                
                // Clear canvas first
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Use the exact scaling logic from the reference
                const scale = Math.min(
                  canvas.width / img.width,
                  canvas.height / img.height
                );
                const x = (canvas.width - img.width * scale) / 2;
                const y = (canvas.height - img.height * scale) / 2;
                
                console.log('üîÑ Scaling signature:', {
                  originalSize: `${img.width}x${img.height}`,
                  canvasSize: `${canvas.width}x${canvas.height}`,
                  scale: scale.toFixed(3),
                  position: `${x.toFixed(1)}, ${y.toFixed(1)}`,
                  finalSize: `${(img.width * scale).toFixed(1)}x${(img.height * scale).toFixed(1)}`
                });
                
                // Draw saved signature with proper scaling and centering
                ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
                
                // Hide placeholder
                placeholder.style.display = 'none';
                
                // Auto-save to signatureData
                signatureData = canvas.toDataURL('image/png', 1.0);
                
                console.log('‚úÖ Signature loaded and centered successfully');
                
                // Update preview with name and date
                document.getElementById('signatureImage').src = signatureData;
                document.getElementById('signaturePreview').style.display = 'block';
                
                // Update name and date
                const signatureName = document.getElementById('signatureName');
                const signatureDate = document.getElementById('signatureDate');
                if (signatureName) {
                  signatureName.textContent = data.full_name || 'Tanda Tangan Tersimpan';
                }
                if (signatureDate) {
                  const now = new Date();
                  signatureDate.textContent = `Dimuat: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}`;
                }
                
                // Show success message
                const preview = document.getElementById('signaturePreview');
                preview.style.background = 'rgba(34, 197, 94, 0.1)';
                preview.style.borderLeft = '4px solid #22c55e';
                
                setTimeout(() => {
                  preview.style.background = 'rgba(99, 102, 241, 0.1)';
                  preview.style.borderLeft = 'none';
                }, 2000);
                
                // Show success alert
                const nameText = data.full_name ? ` (${data.full_name})` : '';
                alert(`‚úÖ Tanda tangan tersimpan berhasil dimuat dari database${nameText}!`);
              };
              
              img.onerror = function() {
                alert('‚ùå Gagal memuat tanda tangan tersimpan. File mungkin rusak.');
              };
              
              img.src = data.signature_data;
              
              // Also save to localStorage as backup
              localStorage.setItem('userSignature', data.signature_data);
              localStorage.setItem('userFullName', data.full_name);
              
              return;
            } else {
              console.log('‚ùå Tidak ada tanda tangan di Supabase, mencoba localStorage...');
            }
          }
          
          // Fallback to localStorage
          const savedSignature = localStorage.getItem('userSignature');
          const savedFullName = localStorage.getItem('userFullName');
          
          console.log('Saved signature exists (localStorage):', !!savedSignature);
          console.log('Saved full name:', savedFullName);
          console.log('All localStorage keys:', Object.keys(localStorage));
          
          if (!savedSignature) {
            console.log('‚ùå No saved signature found in localStorage');
            alert('Tidak ada tanda tangan tersimpan.\n\nSilakan:\n1. Buka halaman Settings\n2. Buat tanda tangan\n3. Klik "Simpan ke Database"\n4. Kembali ke halaman ini\n\nAtau klik tombol "üîç Debug Storage" untuk info lebih detail.');
            return;
          }
          
          console.log('‚úÖ Found saved signature, loading to canvas...');
          
          // Load signature to canvas
          const img = new Image();
          img.onload = function() {
            // Force canvas size to be correct before drawing
            canvas.width = 500;
            canvas.height = 200;
            
            // Clear canvas first
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Use the exact scaling logic from the reference
            const scale = Math.min(
              canvas.width / img.width,
              canvas.height / img.height
            );
            const x = (canvas.width - img.width * scale) / 2;
            const y = (canvas.height - img.height * scale) / 2;
            
            console.log('üîÑ Scaling signature:', {
              originalSize: `${img.width}x${img.height}`,
              canvasSize: `${canvas.width}x${canvas.height}`,
              scale: scale.toFixed(3),
              position: `${x.toFixed(1)}, ${y.toFixed(1)}`,
              finalSize: `${(img.width * scale).toFixed(1)}x${(img.height * scale).toFixed(1)}`
            });
            
            // Draw saved signature with proper scaling and centering
            ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
            
            // Hide placeholder
            placeholder.style.display = 'none';
            
            // Auto-save to signatureData
            signatureData = canvas.toDataURL('image/png', 1.0);
            
            console.log('‚úÖ Signature loaded and centered successfully');
            
            // Update preview with name and date
            document.getElementById('signatureImage').src = signatureData;
            document.getElementById('signaturePreview').style.display = 'block';
            
            // Update name and date
            const signatureName = document.getElementById('signatureName');
            const signatureDate = document.getElementById('signatureDate');
            if (signatureName) {
              signatureName.textContent = savedFullName || 'Tanda Tangan Digital';
            }
            if (signatureDate) {
              const now = new Date();
              signatureDate.textContent = `Dimuat: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}`;
            }
            
            // Show success message
            const preview = document.getElementById('signaturePreview');
            preview.style.background = 'rgba(34, 197, 94, 0.1)';
            preview.style.borderLeft = '4px solid #22c55e';
            
            setTimeout(() => {
              preview.style.background = 'rgba(99, 102, 241, 0.1)';
              preview.style.borderLeft = 'none';
            }, 2000);
            
            // Show success alert
            const nameText = savedFullName ? ` (${savedFullName})` : '';
            alert(`‚úÖ Tanda tangan tersimpan berhasil dimuat${nameText}!`);
          };
          
          img.onerror = function() {
            alert('‚ùå Gagal memuat tanda tangan tersimpan. File mungkin rusak.');
          };
          
          img.src = savedSignature;
          
        } catch (error) {
          console.error('Error loading saved signature:', error);
          alert('‚ùå Terjadi kesalahan saat memuat tanda tangan tersimpan.');
        }
      }

      // Load signature directly from Supabase
      async function loadFromSupabase() {
        try {
          console.log('üîÑ Loading signature directly from Supabase...');
          
          const supabase = window.getSupabase();
          if (!supabase) {
            throw new Error('Supabase tidak tersedia');
          }

          const { data, error } = await supabase.rpc('get_user_signature');
          
          if (error) {
            console.error('‚ùå Supabase error:', error);
            alert(`‚ùå Error Supabase: ${error.message}\n\nKemungkinan:\n1. Script SQL belum dijalankan di Supabase\n2. Function get_user_signature belum ada\n3. User tidak terautentikasi\n\nSilakan jalankan script create-signatures-table.sql di Supabase SQL Editor.`);
            return;
          }

          if (data && data.signature_data) {
            console.log('‚úÖ Tanda tangan ditemukan di Supabase:', data);
            
            // Load signature to canvas
            const img = new Image();
            img.onload = function() {
              canvas.width = 500;
              canvas.height = 200;
              
              // Clear canvas first
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              
              // Use the exact scaling logic from the reference
              const scale = Math.min(
                canvas.width / img.width,
                canvas.height / img.height
              );
              const x = (canvas.width - img.width * scale) / 2;
              const y = (canvas.height - img.height * scale) / 2;
              
              console.log('üîÑ Scaling signature:', {
                originalSize: `${img.width}x${img.height}`,
                canvasSize: `${canvas.width}x${canvas.height}`,
                scale: scale.toFixed(3),
                position: `${x.toFixed(1)}, ${y.toFixed(1)}`,
                finalSize: `${(img.width * scale).toFixed(1)}x${(img.height * scale).toFixed(1)}`
              });
              
              // Draw saved signature with proper scaling and centering
              ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
              
              // Hide placeholder
              placeholder.style.display = 'none';
              
              // Auto-save to signatureData
              signatureData = canvas.toDataURL('image/png', 1.0);
              
              console.log('‚úÖ Signature loaded and centered successfully');
              
              // Update preview with name and date
              document.getElementById('signatureImage').src = signatureData;
              document.getElementById('signaturePreview').style.display = 'block';
              
              // Update name and date
              const signatureName = document.getElementById('signatureName');
              const signatureDate = document.getElementById('signatureDate');
              if (signatureName) {
                signatureName.textContent = data.full_name || 'Tanda Tangan Tersimpan';
              }
              if (signatureDate) {
                const now = new Date();
                signatureDate.textContent = `Dimuat: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}`;
              }
              
              // Show success message
              const preview = document.getElementById('signaturePreview');
              preview.style.background = 'rgba(34, 197, 94, 0.1)';
              preview.style.borderLeft = '4px solid #22c55e';
              
              setTimeout(() => {
                preview.style.background = 'rgba(99, 102, 241, 0.1)';
                preview.style.borderLeft = 'none';
              }, 2000);
              
              // Show success alert
              const nameText = data.full_name ? ` (${data.full_name})` : '';
              alert(`‚úÖ Tanda tangan berhasil dimuat dari database${nameText}!`);
            };
            
            img.onerror = function() {
              alert('‚ùå Gagal memuat tanda tangan tersimpan. File mungkin rusak.');
            };
            
            img.src = data.signature_data;
            
            // Also save to localStorage as backup
            localStorage.setItem('userSignature', data.signature_data);
            localStorage.setItem('userFullName', data.full_name);
            
          } else {
            console.log('‚ùå Tidak ada tanda tangan di Supabase');
            alert('‚ùå Tidak ada tanda tangan di Supabase.\n\nSilakan:\n1. Buka halaman Settings\n2. Buat tanda tangan\n3. Klik "Simpan ke Database"\n4. Kembali ke halaman ini');
          }
          
        } catch (error) {
          console.error('‚ùå Error loading from Supabase:', error);
          alert('‚ùå Terjadi kesalahan saat memuat dari database: ' + error.message);
        }
      }

      // Debug function to check localStorage and Supabase
      async function debugSignatureStorage() {
        console.log('üîç DEBUG: Checking storage...');
        console.log('All localStorage keys:', Object.keys(localStorage));
        
        const userSignature = localStorage.getItem('userSignature');
        const userFullName = localStorage.getItem('userFullName');
        
        console.log('userSignature exists (localStorage):', !!userSignature);
        console.log('userSignature length:', userSignature ? userSignature.length : 0);
        console.log('userFullName:', userFullName);
        
        // Check Supabase
        const supabase = window.getSupabase();
        if (supabase) {
          try {
            console.log('üîç Checking Supabase...');
            const { data, error } = await supabase.rpc('get_user_signature');
            
            if (error) {
              console.error('‚ùå Supabase error:', error);
              alert(`‚ùå Error Supabase: ${error.message}\n\nKemungkinan:\n1. Script SQL belum dijalankan di Supabase\n2. Function get_user_signature belum ada\n3. User tidak terautentikasi\n\nSilakan jalankan script create-signatures-table.sql di Supabase SQL Editor.`);
            } else if (data && data.signature_data) {
              console.log('‚úÖ Tanda tangan ditemukan di Supabase:', data);
              alert(`‚úÖ Tanda tangan ditemukan di Supabase!\n\nNama: ${data.full_name}\nUkuran: ${data.signature_data.length} karakter\n\nTanda tangan siap digunakan.`);
            } else {
              console.log('‚ùå Tidak ada tanda tangan di Supabase');
              alert('‚ùå Tidak ada tanda tangan di Supabase.\n\nSilakan:\n1. Buka halaman Settings\n2. Buat tanda tangan\n3. Klik "Simpan ke Database"\n4. Kembali ke halaman ini');
            }
          } catch (error) {
            console.error('‚ùå Error checking Supabase:', error);
            alert(`‚ùå Error checking Supabase: ${error.message}`);
          }
        } else {
          console.log('‚ùå Supabase tidak tersedia');
          alert('‚ùå Supabase tidak tersedia.\n\nPeriksa konfigurasi Supabase.');
        }
        
        if (userSignature) {
          console.log('userSignature preview:', userSignature.substring(0, 100) + '...');
          alert(`‚úÖ Tanda tangan ditemukan di localStorage!\n\nNama: ${userFullName || 'Tidak ada'}\nUkuran: ${userSignature.length} karakter\n\nTanda tangan siap digunakan.`);
        } else {
          console.log('‚ùå No signature found in localStorage');
        }
      }

      // Check for saved signature on page load
      function checkForSavedSignature() {
        try {
          console.log('üîç Checking for saved signature...');
          const savedSignature = localStorage.getItem('userSignature');
          const savedFullName = localStorage.getItem('userFullName');
          
          console.log('Saved signature exists:', !!savedSignature);
          console.log('Saved full name:', savedFullName);
          
          if (savedSignature) {
            console.log('‚úÖ Found saved signature, updating UI...');
            // Update the tips text
            const tipsText = document.getElementById('signatureTipsText');
            if (tipsText) {
              const nameText = savedFullName ? ` (${savedFullName})` : '';
              tipsText.innerHTML = `Sudah punya tanda tangan digital${nameText}? Gunakan yang sudah tersimpan!`;
            }
            
            // Change button text to be more specific
            const loadButton = document.querySelector('[onclick="loadSavedSignature()"]');
            if (loadButton) {
              loadButton.innerHTML = 'üìù Gunakan Tanda Tangan Tersimpan';
            }
            
            // Show the tips section
            const tipsSection = document.getElementById('signatureTipsSection');
            if (tipsSection) {
              tipsSection.style.display = 'block';
            }
          } else {
            console.log('‚ùå No saved signature found');
            // Update tips text to show no signature found
            const tipsText = document.getElementById('signatureTipsText');
            if (tipsText) {
              tipsText.innerHTML = 'Belum ada tanda tangan tersimpan. Buat di halaman Settings terlebih dahulu.';
            }
            
            // Show the tips section anyway for debugging
            const tipsSection = document.getElementById('signatureTipsSection');
            if (tipsSection) {
              tipsSection.style.display = 'block';
            }
          }
        } catch (error) {
          console.error('Error checking for saved signature:', error);
        }
      }




      // Emoji Picker Functions
      function toggleEmojiPicker() {
        const emojiPicker = document.getElementById('descriptionEmojiPicker');
        if (emojiPicker) {
          if (emojiPicker.style.display === 'none') {
            emojiPicker.style.display = 'block';
          } else {
            emojiPicker.style.display = 'none';
          }
        }
      }

      function insertEmoji(emoji) {
        const textarea = document.getElementById('descriptionText');
        if (textarea) {
          const currentPos = textarea.selectionStart;
          const textBefore = textarea.value.substring(0, currentPos);
          const textAfter = textarea.value.substring(textarea.selectionEnd);
          
          textarea.value = textBefore + emoji + textAfter;
          textarea.focus();
          textarea.setSelectionRange(currentPos + emoji.length, currentPos + emoji.length);
          
          // Hide emoji picker after selection
          const emojiPicker = document.getElementById('descriptionEmojiPicker');
          if (emojiPicker) {
            emojiPicker.style.display = 'none';
          }
        }
      }
    </script>
    
    <script>
      // Navigation logic for logged in users
      document.addEventListener('DOMContentLoaded', function() {
        // Check if user is logged in
        const isLoggedIn = localStorage.getItem('speakup_logged_in');
        
        if (isLoggedIn === 'true') {
          // User is logged in, hide Sign button and show Logout button
          updateNavigationForLoggedInUser();
        } else {
          // User is not logged in, show Sign button and hide Logout button
          updateNavigationForHomepage();
        }
      });
      
      function updateNavigationForLoggedInUser() {
        console.log('Updating navigation for logged in user...');
        
        // Show all navigation items
        const navItems = document.querySelectorAll('.desktop-nav .nav-item');
        navItems.forEach(item => {
          item.style.display = 'flex';
        });
        
        // Convert Sign button to Logout button
        const signButton = document.getElementById('signButton');
        if (signButton) {
          console.log('Converting Sign button to Logout button');
          signButton.href = 'javascript:void(0)';
          signButton.onclick = logout;
          signButton.title = 'Logout';
          signButton.innerHTML = `
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
            </svg>
            <span>Logout</span>
          `;
        }
        
        // Show Speak! button
        const speakButton = document.querySelector('.plus-btn');
        if (speakButton) {
          speakButton.style.display = 'flex';
        }
        
        // Handle Profile button click to go to own profile
        const profileButton = document.querySelector('a[href="./profile-desktop.html"]');
        if (profileButton) {
          profileButton.addEventListener('click', function(e) {
            e.preventDefault();
            // Navigate to own profile (without URL parameter)
            window.location.href = 'profile-desktop.html';
          });
        }
      }
      
      function updateNavigationForHomepage() {
        console.log('Updating navigation for homepage (not logged in)...');
        
        // Show only Home and Login navigation items for non-logged in users
        const navItems = document.querySelectorAll('.desktop-nav .nav-item');
        navItems.forEach(item => {
          if (item.textContent.includes('Home') || 
              item.textContent.includes('Login')) {
            item.style.display = 'flex';
          } else {
            item.style.display = 'none';
          }
        });
        
        // Reset Login button to original state
        const signButton = document.getElementById('signButton');
        if (signButton) {
          console.log('Resetting Login button to original state');
          signButton.href = './sign-desktop.html';
          signButton.onclick = null;
          signButton.title = 'Login';
          signButton.innerHTML = `
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 10a1 1 0 011-1h8.586l-3.293-3.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 11-1.414-1.414L12.586 11H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>
            <span>Login</span>
          `;
        }
        
        // Hide Speak! button for non-logged in users
        const speakButton = document.querySelector('.plus-btn');
        if (speakButton) {
          speakButton.style.display = 'none';
        }
      }
      
      // Logout handled globally in assets/js/app.js
    </script>
  </div>

  <script src="assets/js/app.js"></script>
  <!-- Supabase SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="config/supabase-config.js"></script>
  <script src="config/supabase-client.js"></script>
  <script src="config/petitions-api.js"></script>
  </body>
</html>

