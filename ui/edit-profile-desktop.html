<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SpeakUp! â€” Edit Profile (Desktop)</title>
  <link rel="icon" type="image/png" href="assets/logo/logo apps.png?v=2">
  <link rel="shortcut icon" type="image/png" href="assets/logo/logo apps.png?v=2">
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    :root { --bg:#ffffff; --panel:#ffffff; --text:#374151; --muted:#64748b; --accent:#38bdf8; --border:#e5e7eb; }
    .logo img[data-theme="light"]{display:block!important}.logo img[data-theme="dark"]{display:none!important}
    html,body,main,.desktop-container,.desktop-nav,.card,.tabs .tab,.modal .box{background:#ffffff!important}
    body{margin:0;padding:0;min-height:100vh;background:#ffffff!important;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
    .desktop-nav{display:block!important}
    .desktop-container{max-width:1024px;margin:0 auto;padding:24px 32px}
    .desktop-nav .nav-item.active{background:#ffffff!important;color:#374151!important;border:1px solid #e5e7eb!important}
    .desktop-nav .nav-item.plus-btn,.btn.primary{background:#ffffff!important;color:#374151!important;border:1px solid #e5e7eb!important}
    body.desktop-page, body.desktop-page *:not(h1):not(h2):not(h3):not(h4):not(h5):not(h6){color:#374151!important}
    
    /* Logo SpeakUp! berwarna biru */
    .desktop-nav .logo { 
      color: #38bdf8 !important; 
      font-weight: 800; 
      letter-spacing: 0.5px; 
    }

    /* Force logo color with maximum specificity */
    .desktop-page .desktop-nav .logo,
    body.desktop-page .desktop-nav .logo,
    html body.desktop-page .desktop-nav .logo {
      color: #38bdf8 !important;
      font-weight: 800 !important;
      letter-spacing: 0.5px !important;
    }

    .edit-section {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* Zoom Button Styles */
    .zoom-button {
      background: #f3f4f6;
      color: #374151;
      border: 1px solid #d1d5db;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.2s;
    }

    .zoom-button:hover {
      background: #e5e7eb;
    }

    .zoom-button:active {
      transform: scale(0.95);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="desktop-page">
  <div class="desktop-container">
    <nav class="desktop-nav" aria-label="Navigasi desktop">
      <div class="desktop-nav-inner">
        <div class="nav-left">
          <div class="logo">SpeakUp!</div>
          <a href="./desktop.html" class="nav-item" title="Home">
            <svg fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg>
            <span>Home</span>
          </a>
          <button class="nav-item plus-btn" data-open-create title="Speak!">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
            </svg>
            <span>Speak!</span>
          </button>
          <a href="./timeline-desktop.html" class="nav-item" title="Timeline">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
            <span>Timeline</span>
          </a>
          <a href="./petitions-desktop.html" class="nav-item" title="Aspirasi">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>
            <span>Aspirasi</span>
          </a>
        </div>
        <div class="nav-right">
          <a href="./settings-desktop.html" class="nav-item" title="Settings">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/></svg>
            <span>Settings</span>
          </a>
          <a href="./profile-desktop.html" class="nav-item active" title="Profile">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>
            <span>Profile</span>
          </a>
          <a href="./sign-desktop.html" class="nav-item" id="signButton" title="Login">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 10a1 1 0 011-1h8.586l-3.293-3.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 11-1.414-1.414L12.586 11H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>
            <span>Login</span>
          </a>
        </div>
      </div>
    </nav>

    <main>
      <section class="container">
        <!-- Header -->
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 32px;">
          <button onclick="goBack()" style="background: none; border: none; color: #38bdf8; cursor: pointer; padding: 8px; display: flex; align-items: center; gap: 8px; border-radius: 6px; transition: all 0.2s;" onmouseover="this.style.backgroundColor='#f3f4f6'" onmouseout="this.style.backgroundColor='transparent'">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
            </svg>
            Kembali
          </button>
          <h1 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">Edit Profil</h1>
        </div>

        <!-- Profile Picture & Banner Section -->
        <div class="edit-section">
          <h2 style="margin: 0 0 24px; font-size: 20px; font-weight: 600; color: #1f2937;">Foto Profil & Banner</h2>
          
          <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 32px; align-items: start;">
            <!-- Profile Picture -->
            <div style="text-align: center;">
              <div style="position: relative; display: inline-block;">
                <div id="profileAvatar" style="width: 120px; height: 120px; border-radius: 50%; background: #38bdf8; margin: 0 auto; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: bold; cursor: pointer; position: relative; border: 4px solid #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                  <svg width="60" height="60" fill="currentColor" viewBox="0 0 20 20" style="color: #9ca3af;">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <button onclick="changeAvatar()" style="position: absolute; bottom: 8px; right: 8px; background: white; color: #38bdf8; border: none; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; opacity: 0.7; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" title="Edit Profile Picture">
                  <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                  </svg>
                </button>
              </div>
              <p style="margin: 12px 0 0; color: #6b7280; font-size: 14px;">Klik untuk mengubah foto profil</p>
            </div>

            <!-- Banner -->
            <div>
              <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Banner Profil</label>
              <div id="profileBanner" style="height: 120px; background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%); border-radius: 12px; position: relative; overflow: hidden; cursor: pointer;">
                <button onclick="changeBanner()" style="position: absolute; top: 8px; right: 8px; background: white; color: #38bdf8; border: none; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; opacity: 0.7; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" title="Edit Banner">
                  <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                  </svg>
                </button>
              </div>
              <p style="margin: 8px 0 0; color: #6b7280; font-size: 14px;">Klik untuk mengubah banner</p>
            </div>
          </div>
        </div>

        <!-- Profile Information -->
        <div class="edit-section">
          <h2 style="margin: 0 0 24px; font-size: 20px; font-weight: 600; color: #1f2937;">Informasi Profil</h2>
          
          <form id="profileForm">
            <!-- Hidden inputs for file uploads -->
            <input type="file" id="avatarInput" name="avatar" accept="image/*" style="display: none;">
            <input type="file" id="bannerInput" name="banner" accept="image/*" style="display: none;">
            
            <div class="form-grid">
              <div>
                <label for="displayName" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Nama Tampilan</label>
                <input type="text" id="displayName" name="displayName" value="" placeholder="Masukkan nama tampilan" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'">
                <p style="margin: 4px 0 0; color: #6b7280; font-size: 14px;">Nama yang akan ditampilkan di profil Anda</p>
              </div>

              <div>
                <label for="username" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Username</label>
                <input type="text" id="username" name="username" value="" placeholder="Masukkan username" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'">
                <p style="margin: 4px 0 0; color: #6b7280; font-size: 14px;">Username unik untuk akun Anda</p>
              </div>

              <div>
                <label for="title" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Profesi/Title</label>
                <div style="position: relative;">
                  <input type="text" id="title" name="title" value="" placeholder="Ketik profesi Anda..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'" oninput="filterProfessions(this.value)" onkeydown="handleProfessionKeydown(event)">
                  <div id="professionDropdown" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d1d5db; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>
                </div>
                <p style="margin: 4px 0 0; color: #6b7280; font-size: 14px;">Pilih atau ketik profesi Anda</p>
              </div>

              <div>
                <label for="location" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Lokasi</label>
                <div style="position: relative;">
                  <input type="text" id="location" name="location" value="" placeholder="Ketik nama kota..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'" oninput="filterCities(this.value)" onkeydown="handleLocationKeydown(event)">
                  <div id="locationDropdown" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d1d5db; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>
                </div>
                <p style="margin: 4px 0 0; color: #6b7280; font-size: 14px;">Pilih kota di Indonesia</p>
              </div>

              <div style="grid-column: 1 / -1;">
                <label for="bio" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Bio</label>
                <textarea id="bio" name="bio" rows="4" placeholder="Ceritakan tentang diri Anda..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; outline: none; resize: vertical; font-family: inherit; transition: border-color 0.2s;" onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'"></textarea>
                <p style="margin: 4px 0 0; color: #6b7280; font-size: 14px;">Deskripsi singkat tentang diri Anda (maksimal 150 karakter)</p>
              </div>

              <div>
                <label for="website" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Website</label>
                <input type="url" id="website" name="website" value="" placeholder="https://example.com" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'">
                <p style="margin: 4px 0 0; color: #6b7280; font-size: 14px;">Link ke website atau blog Anda</p>
              </div>

              <div>
                <label for="privacy" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Privasi Profil</label>
                <select id="privacy" name="privacy" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; outline: none; background: white; transition: border-color 0.2s;" onfocus="this.style.borderColor='#38bdf8'" onblur="this.style.borderColor='#d1d5db'">
                  <option value="verified" id="verifiedOption">Verified Account</option>
                  <option value="custom">Public</option>
                  <option value="anonymous">Tetap Anonim</option>
                </select>
                <p style="margin: 4px 0 0; color: #6b7280; font-size: 14px;">Tingkat privasi untuk profil Anda</p>
              </div>
            </div>
          </form>
        </div>

        <!-- Notification Settings -->
        <div class="edit-section">
          <h2 style="margin: 0 0 24px; font-size: 20px; font-weight: 600; color: #1f2937;">Pengaturan Notifikasi</h2>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <div>
              <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600; color: #374151;">Email</h3>
              <div style="display: flex; flex-direction: column; gap: 12px;">
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                  <input type="checkbox" id="emailNotifications" name="emailNotifications" checked style="width: 18px; height: 18px; accent-color: #38bdf8;">
                  <span>Notifikasi email</span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                  <input type="checkbox" id="marketingEmails" name="marketingEmails" style="width: 18px; height: 18px; accent-color: #38bdf8;">
                  <span>Email marketing</span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                  <input type="checkbox" id="weeklyDigest" name="weeklyDigest" checked style="width: 18px; height: 18px; accent-color: #38bdf8;">
                  <span>Ringkasan mingguan</span>
                </label>
              </div>
            </div>

            <div>
              <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600; color: #374151;">Aplikasi</h3>
              <div style="display: flex; flex-direction: column; gap: 12px;">
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                  <input type="checkbox" id="pushNotifications" name="pushNotifications" checked style="width: 18px; height: 18px; accent-color: #38bdf8;">
                  <span>Notifikasi push</span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                  <input type="checkbox" id="soundNotifications" name="soundNotifications" checked style="width: 18px; height: 18px; accent-color: #38bdf8;">
                  <span>Notifikasi suara</span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                  <input type="checkbox" id="vibrationNotifications" name="vibrationNotifications" checked style="width: 18px; height: 18px; accent-color: #38bdf8;">
                  <span>Getaran</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="edit-section" style="border-top: 1px solid #e5e7eb; padding-top: 24px; margin-top: 24px;">
          <div style="display: flex; gap: 16px; justify-content: flex-end; align-items: center;">
            <button id="resetButton" onclick="resetProfile()" style="background: #6b7280; color: white !important; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; font-size: 14px;" onmouseover="this.style.backgroundColor='#4b5563'; this.style.color='white !important';" onmouseout="this.style.backgroundColor='#6b7280'; this.style.color='white !important';">
              Reset Profile
            </button>
            <button id="saveButton" onclick="saveProfile()" style="background: #38bdf8; color: white !important; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; font-size: 14px;" onmouseover="this.style.backgroundColor='#0ea5e9'; this.style.color='white !important';" onmouseout="this.style.backgroundColor='#38bdf8'; this.style.color='white !important';">
              Simpan Perubahan
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Supabase SDK -->
  <script src="config/supabase-config.js"></script>
  <script src="config/supabase-bootstrap.js"></script>
  <script src="assets/js/app.js"></script>
  <script>
    // Initialize Supabase client
    let supabase;
    let currentUser = null;
    let userProfile = null;
    
    // Daftar kota-kota di Indonesia
    const indonesiaCities = [
      'Jakarta', 'Surabaya', 'Bandung', 'Medan', 'Semarang', 'Makassar', 'Palembang', 'Tangerang', 'Depok', 'Bekasi',
      'Yogyakarta', 'Malang', 'Surakarta', 'Batam', 'Bandar Lampung', 'Bogor', 'Pekanbaru', 'Padang', 'Denpasar', 'Samarinda',
      'Tasikmalaya', 'Serang', 'Balikpapan', 'Pontianak', 'Cimahi', 'Jambi', 'Manado', 'Mataram', 'Kupang', 'Banjarmasin',
      'Cirebon', 'Pekalongan', 'Kediri', 'Purwokerto', 'Sukabumi', 'Cilegon', 'Banda Aceh', 'Jayapura', 'Palu', 'Ambon',
      'Kendari', 'Pangkal Pinang', 'Gorontalo', 'Mamuju', 'Palangkaraya', 'Ternate', 'Sorong', 'Merauke', 'Biak', 'Manokwari',
      'Fakfak', 'Kaimana', 'Timika', 'Wamena', 'Nabire', 'Serui', 'Sarmi', 'Tanah Merah', 'Agats', 'Oksibil',
      'Kotamobagu', 'Tomohon', 'Bitung', 'Tahuna', 'Siau', 'Talaud', 'Sitaro', 'Minahasa', 'Bolaang Mongondow', 'Bolaang Mongondow Utara',
      'Bolaang Mongondow Selatan', 'Bolaang Mongondow Timur', 'Kepulauan Siau Tagulandang Biaro', 'Kepulauan Talaud', 'Kepulauan Sangihe', 'Kepulauan Sitaro', 'Minahasa Selatan', 'Minahasa Tenggara', 'Minahasa Utara', 'Minahasa'
    ];
    
    let selectedCityIndex = -1;
    let selectedProfessionIndex = -1;
    
    // Global error handler to catch extension-related errors
    window.addEventListener('error', function(event) {
      if (event.message && (
          event.message.includes('Could not establish connection') ||
          event.message.includes('Receiving end does not exist') ||
          event.message.includes('Extension context invalidated')
        )) {
        console.warn('Browser extension connection error (ignored):', event.message);
        event.preventDefault();
        event.stopPropagation();
        return false;
      }
    });
    
    window.addEventListener('unhandledrejection', function(event) {
      if (event.reason && event.reason.message && (
          event.reason.message.includes('Could not establish connection') ||
          event.reason.message.includes('Receiving end does not exist') ||
          event.reason.message.includes('Extension context invalidated')
        )) {
        console.warn('Browser extension connection error (ignored):', event.reason.message);
        event.preventDefault();
        event.stopPropagation();
        return false;
      }
    });
    
    // Additional handler for Chrome extension errors
    if (typeof chrome !== 'undefined' && chrome.runtime) {
      try {
        chrome.runtime.onConnect.addListener(function(port) {
          // Handle extension port connections
        });
      } catch (e) {
        // Ignore extension errors
      }
    }
    
    // Override console.error to filter extension errors
    const originalConsoleError = console.error;
    console.error = function(...args) {
      const message = args.join(' ');
      if (message.includes('Could not establish connection') || 
          message.includes('Receiving end does not exist') ||
          message.includes('Extension context invalidated')) {
        console.warn('Browser extension error (filtered):', message);
        return;
      }
      originalConsoleError.apply(console, args);
    };
    
    // Wait for config to load
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('=== DOM CONTENT LOADED ===');
      console.log('Window getSupabase:', window.getSupabase);
      console.log('Window SUPABASE_CONFIG:', window.SUPABASE_CONFIG);
      console.log('Window supabase:', window.supabase);
      
      // Initialize Supabase after config is loaded
      if (window.getSupabase) {
        supabase = window.getSupabase();
        console.log('Supabase initialized via getSupabase()');
        console.log('Supabase client after getSupabase():', supabase);
        
        // Initialize verified option state
        initializeVerifiedOption();
        
        // Get current user
        console.log('Getting current session...');
        const { data: { session } } = await supabase.auth.getSession();
        console.log('Session result:', session);
        
        if (session) {
          currentUser = session.user;
          console.log('User from session:', currentUser);
          // Wait a bit for DOM elements to be ready
          setTimeout(async () => {
            await loadUserProfile();
          }, 100);
          // User is logged in, update navigation
          updateNavigationForLoggedInUser();
        } else {
          // Check localStorage fallback
          console.log('No session found, checking localStorage...');
          const isLoggedIn = localStorage.getItem('speakup_logged_in');
          const userId = localStorage.getItem('speakup_user_id');
          const userEmail = localStorage.getItem('speakup_user_email');
          
          console.log('LocalStorage data:', { isLoggedIn, userId, userEmail });
          
          if (isLoggedIn === 'true' && userId) {
            // User is logged in via localStorage, create currentUser object
            currentUser = {
              id: userId,
              email: userEmail,
              user_metadata: {
                full_name: userEmail?.split('@')[0] || 'User'
              }
            };
            console.log('Current user from localStorage:', currentUser);
            // Wait a bit for DOM elements to be ready
            setTimeout(async () => {
              await loadUserProfile();
            }, 100);
            updateNavigationForLoggedInUser();
          } else {
            console.log('User not logged in, redirecting to login...');
            // User is not logged in, redirect to login
            window.location.href = './sign-desktop.html';
          }
        }
      } else if (window.SUPABASE_CONFIG && window.supabase && window.supabase.createClient) {
        supabase = window.supabase.createClient(
          window.SUPABASE_CONFIG.url,
          window.SUPABASE_CONFIG.anonKey
        );
        console.log('Supabase initialized via createClient()');
        console.log('Supabase client after createClient():', supabase);
        
        // Initialize verified option state
        initializeVerifiedOption();
        
        // Get current user
        console.log('Getting current session...');
        const { data: { session } } = await supabase.auth.getSession();
        console.log('Session result:', session);
        
        if (session) {
          currentUser = session.user;
          console.log('User from session:', currentUser);
          // Wait a bit for DOM elements to be ready
          setTimeout(async () => {
            await loadUserProfile();
          }, 100);
          // User is logged in, update navigation
          updateNavigationForLoggedInUser();
        } else {
          // Check localStorage fallback
          console.log('No session found, checking localStorage...');
          const isLoggedIn = localStorage.getItem('speakup_logged_in');
          const userId = localStorage.getItem('speakup_user_id');
          const userEmail = localStorage.getItem('speakup_user_email');
          
          console.log('LocalStorage data:', { isLoggedIn, userId, userEmail });
          
          if (isLoggedIn === 'true' && userId) {
            // User is logged in via localStorage, create currentUser object
            currentUser = {
              id: userId,
              email: userEmail,
              user_metadata: {
                full_name: userEmail?.split('@')[0] || 'User'
              }
            };
            console.log('Current user from localStorage:', currentUser);
            // Wait a bit for DOM elements to be ready
            setTimeout(async () => {
              await loadUserProfile();
            }, 100);
            updateNavigationForLoggedInUser();
          } else {
            console.log('User not logged in, redirecting to login...');
            // User is not logged in, redirect to login
            window.location.href = './sign-desktop.html';
          }
        }
      } else {
        console.log('Supabase not available, using fallback...');
        // Fallback if Supabase is not available
        const isLoggedIn = localStorage.getItem('speakup_logged_in');
        const userId = localStorage.getItem('speakup_user_id');
        if (isLoggedIn === 'true' && userId) {
          // User is logged in via localStorage, create currentUser object
          currentUser = {
            id: userId,
            email: localStorage.getItem('speakup_user_email'),
            user_metadata: {
              full_name: localStorage.getItem('speakup_user_email')?.split('@')[0] || 'User'
            }
          };
          console.log('Current user from localStorage fallback:', currentUser);
          // Wait a bit for DOM elements to be ready
          setTimeout(async () => {
            await loadUserProfile();
          }, 100);
          updateNavigationForLoggedInUser();
        } else {
          console.log('User not logged in, redirecting to login...');
          window.location.href = './sign-desktop.html';
        }
      }
    });
    
    function updateNavigationForLoggedInUser() {
      console.log('Updating navigation for logged in user...');
      
      // Update navigation buttons
      const loginBtn = document.querySelector('.nav-item[href="./sign-desktop.html"]');
      if (loginBtn) {
        loginBtn.textContent = 'Logout';
        loginBtn.href = '#';
        loginBtn.onclick = function(e) {
          e.preventDefault();
          logout();
        };
      }
    }
    
    // Logout function
    async function logout() {
      try {
        if (supabase) {
          await supabase.auth.signOut();
        }
        // Clear localStorage
        localStorage.removeItem('speakup_logged_in');
        localStorage.removeItem('speakup_user_id');
        localStorage.removeItem('speakup_user_email');
        localStorage.removeItem('speakup_viewing_user_id');
        // Redirect to login
        window.location.href = './sign-desktop.html';
      } catch (error) {
        console.error('Error during logout:', error);
        // Still redirect even if logout fails
        window.location.href = './sign-desktop.html';
      }
    }
    
    // Logout handled globally in assets/js/app.js
    
    // Debug function to check profile data
    window.debugProfile = async function() {
      console.log('=== DEBUG PROFILE START ===');
      console.log('Supabase client:', supabase);
      console.log('Current user:', currentUser);
      
      if (!supabase) {
        console.error('Supabase not available');
        return;
      }
      
      if (!currentUser) {
        console.error('Current user not available');
        return;
      }
      
      try {
        const { data: profile, error } = await supabase
          .from('profiles')
          .select('*')
          .eq('id', currentUser.id)
          .single();
          
        console.log('Profile query result:', { profile, error });
        
        if (error) {
          console.error('Error:', error);
        } else if (profile) {
          console.log('Profile data found:', profile);
        } else {
          console.log('No profile data found');
        }
      } catch (err) {
        console.error('Exception:', err);
      }
      
      console.log('=== DEBUG PROFILE END ===');
    };
    
    async function loadUserProfile() {
      console.log('Loading user profile...');
      
      if (!supabase) {
        console.error('Supabase client not available');
        return;
      }
      
      if (!currentUser) {
        console.error('Current user not available');
        return;
      }
      
      if (!currentUser.id) {
        console.error('Current user ID not available');
        return;
      }
      
      try {
        // Always fetch fresh data from database to ensure we have the latest data
        console.log('Fetching fresh data from database for user ID:', currentUser.id);
        const { data: dbData, error } = await supabase
          .from('profiles')
          .select('*')
          .eq('id', currentUser.id)
          .single();
          
        console.log('Database query result:', { dbData, error });
          
        if (error && error.code !== 'PGRST116') { // PGRST116 = no rows returned
          console.error('Error loading profile:', error);
          showNotification('Gagal memuat profil', 'error');
          return;
        }
        
        const data = dbData;
        console.log('Data from database:', data);
        
        if (data) {
          // Store profile data in variable
          userProfile = data;
          console.log('Profile data loaded and stored:', userProfile);
          
          // Check if profile has old test data and clear it (only for specific test cases)
          if ((data.bio && data.bio.includes('wadwdawd')) || 
              (data.website && data.website.includes('dika-medical-blog.com')) ||
              (data.location && data.location.includes('Jakarta') && data.bio && data.bio.includes('wadwdawd'))) {
            console.log('Found old test data, clearing form...');
            clearForm();
            return;
          }
          
          // Fill form with existing data
          console.log('Filling form with data:', {
            full_name: data.full_name,
            username: data.username,
            title: data.title,
            bio: data.bio,
            location: data.location,
            website: data.website,
            identity: data.identity,
            avatar_url: data.avatar_url,
            banner_url: data.banner_url
          });
          
          const displayNameField = document.getElementById('displayName');
          const usernameField = document.getElementById('username');
          const titleField = document.getElementById('title');
          const bioField = document.getElementById('bio');
          const locationField = document.getElementById('location');
          const websiteField = document.getElementById('website');
          
          if (displayNameField) displayNameField.value = data.full_name || '';
          if (usernameField) usernameField.value = data.username || '';
          if (titleField) titleField.value = data.title || '';
          if (bioField) bioField.value = data.bio || '';
          if (locationField) locationField.value = data.location || '';
          if (websiteField) websiteField.value = data.website || '';
          
          console.log('Profile data loaded successfully');
          
          // Set privacy profile based on identity
          const privacySelect = document.getElementById('privacy');
          const verifiedOption = document.getElementById('verifiedOption');
          
          if (data.identity === 'verified' && data.is_verified) {
            // User is verified - enable verified option and select it
            privacySelect.value = 'verified';
            verifiedOption.disabled = false;
            verifiedOption.style.color = '#374151';
            verifiedOption.textContent = 'Verified Account';
            // Disable changing if user is verified
            privacySelect.disabled = true;
          } else {
            // User is not verified - disable verified option but keep it visible
            verifiedOption.disabled = true;
            verifiedOption.style.color = '#9ca3af';
            verifiedOption.textContent = 'Verified Account (Belum diverifikasi)';
            
            if (data.identity === 'anonymous') {
              privacySelect.value = 'anonymous';
            } else {
              privacySelect.value = data.privacy_profile || 'custom';
            }
          }
          
          // Set avatar if exists
          const avatar = document.getElementById('profileAvatar');
          
          if (data.avatar_url) {
            if (avatar) {
              avatar.innerHTML = `<img src="${data.avatar_url}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            }
          } else {
            if (avatar) {
              avatar.innerHTML = `
                <svg width="60" height="60" fill="currentColor" viewBox="0 0 20 20" style="color: #9ca3af;">
                  <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                </svg>
              `;
            }
          }
          
          // Set banner if exists
          const banner = document.getElementById('profileBanner');
          
          if (data.banner_url) {
            if (banner) {
              banner.style.background = `url('${data.banner_url}') center/contain`;
            }
          } else {
            if (banner) {
              banner.style.background = 'linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)';
            }
          }
        } else {
          // No profile data found, create default profile data
          console.log('No profile data found, creating default profile');
          userProfile = {
            id: currentUser.id,
            full_name: currentUser.user_metadata?.full_name || currentUser.email?.split('@')[0] || 'User',
            username: currentUser.email?.split('@')[0] || 'user',
            title: '',
            bio: '',
            location: '',
            website: '',
            privacy_profile: 'custom',
            identity: 'custom_anon',
            avatar_url: null,
            banner_url: null
          };
          
          // Fill form with default data
          document.getElementById('displayName').value = userProfile.full_name;
          document.getElementById('username').value = userProfile.username;
          document.getElementById('title').value = userProfile.title;
          document.getElementById('bio').value = userProfile.bio;
          document.getElementById('location').value = userProfile.location;
          document.getElementById('website').value = userProfile.website;
          
          // Set default privacy
          document.getElementById('privacy').value = 'custom';
          
          // Set default avatar
          const avatar = document.getElementById('profileAvatar');
          avatar.innerHTML = `
            <svg width="60" height="60" fill="currentColor" viewBox="0 0 20 20" style="color: #9ca3af;">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
          `;
          
          // Set default banner
          const banner = document.getElementById('profileBanner');
          banner.style.background = 'linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)';
        }
      } catch (error) {
        console.error('Error loading profile:', error);
        showNotification('Gagal memuat profil', 'error');
      }
    }
    
    function goBack() {
      window.history.back();
    }
    
    function initializeVerifiedOption() {
      // Initialize verified option as disabled by default
      const verifiedOption = document.getElementById('verifiedOption');
      if (verifiedOption) {
        verifiedOption.disabled = true;
        verifiedOption.style.color = '#9ca3af';
        verifiedOption.textContent = 'Verified Account (Belum diverifikasi)';
      }
    }
    
    function clearForm() {
      // Clear all form fields
      document.getElementById('displayName').value = '';
      document.getElementById('username').value = '';
      document.getElementById('title').value = '';
      document.getElementById('bio').value = '';
      document.getElementById('location').value = '';
      document.getElementById('website').value = '';
      document.getElementById('privacy').value = 'custom';
      
      // Reset avatar and banner
      const avatar = document.getElementById('profileAvatar');
      if (avatar) {
        avatar.innerHTML = `
          <svg width="60" height="60" fill="currentColor" viewBox="0 0 20 20" style="color: #9ca3af;">
            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
          </svg>
        `;
      }
      
      const banner = document.getElementById('profileBanner');
      if (banner) {
        banner.style.background = 'linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)';
      }
    }
    
    // File upload handlers
    function handleAvatarUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const avatar = document.getElementById('profileAvatar');
          if (avatar) {
            avatar.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
          }
        };
        reader.readAsDataURL(file);
      }
    }
    
    function handleBannerUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const banner = document.getElementById('profileBanner');
          if (banner) {
            banner.style.background = `url('${e.target.result}') center/contain`;
          }
        };
        reader.readAsDataURL(file);
      }
    }
    
    // City search functionality
    function searchCities() {
      const input = document.getElementById('location');
      const query = input.value.toLowerCase();
      
      if (query.length < 2) {
        hideCitySuggestions();
        return;
      }
      
      const filteredCities = indonesiaCities.filter(city => 
        city.toLowerCase().includes(query)
      );
      
      showCitySuggestions(filteredCities);
    }
    
    function showCitySuggestions(cities) {
      hideCitySuggestions(); // Clear existing suggestions
      
      const input = document.getElementById('location');
      const container = input.parentElement;
      
      const suggestionsDiv = document.createElement('div');
      suggestionsDiv.id = 'citySuggestions';
      suggestionsDiv.style.cssText = `
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
      `;
      
      cities.forEach((city, index) => {
        const cityDiv = document.createElement('div');
        cityDiv.textContent = city;
        cityDiv.style.cssText = `
          padding: 8px 12px;
          cursor: pointer;
          border-bottom: 1px solid #f3f4f6;
        `;
        cityDiv.onmouseover = () => cityDiv.style.backgroundColor = '#f3f4f6';
        cityDiv.onmouseout = () => cityDiv.style.backgroundColor = 'white';
        cityDiv.onclick = () => selectCity(city, index);
        suggestionsDiv.appendChild(cityDiv);
      });
      
      container.style.position = 'relative';
      container.appendChild(suggestionsDiv);
    }
    
    function hideCitySuggestions() {
      const suggestions = document.getElementById('citySuggestions');
      if (suggestions) {
        suggestions.remove();
      }
    }
    
    function selectCity(city, index) {
      document.getElementById('location').value = city;
      selectedCityIndex = index;
      hideCitySuggestions();
    }
    
    // Profession search functionality
    function searchProfessions() {
      const input = document.getElementById('title');
      const query = input.value.toLowerCase();
      
      if (query.length < 2) {
        hideProfessionSuggestions();
        return;
      }
      
      const filteredProfessions = professions.filter(profession => 
        profession.toLowerCase().includes(query)
      );
      
      showProfessionSuggestions(filteredProfessions);
    }
    
    function showProfessionSuggestions(professions) {
      hideProfessionSuggestions(); // Clear existing suggestions
      
      const input = document.getElementById('title');
      const container = input.parentElement;
      
      const suggestionsDiv = document.createElement('div');
      suggestionsDiv.id = 'professionSuggestions';
      suggestionsDiv.style.cssText = `
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
      `;
      
      professions.forEach((profession, index) => {
        const professionDiv = document.createElement('div');
        professionDiv.textContent = profession;
        professionDiv.style.cssText = `
          padding: 8px 12px;
          cursor: pointer;
          border-bottom: 1px solid #f3f4f6;
        `;
        professionDiv.onmouseover = () => professionDiv.style.backgroundColor = '#f3f4f6';
        professionDiv.onmouseout = () => professionDiv.style.backgroundColor = 'white';
        professionDiv.onclick = () => selectProfession(profession, index);
        suggestionsDiv.appendChild(professionDiv);
      });
      
      container.style.position = 'relative';
      container.appendChild(suggestionsDiv);
    }
    
    function hideProfessionSuggestions() {
      const suggestions = document.getElementById('professionSuggestions');
      if (suggestions) {
        suggestions.remove();
      }
    }
    
    function selectProfession(profession, index) {
      document.getElementById('title').value = profession;
      selectedProfessionIndex = index;
      hideProfessionSuggestions();
    }
    
    // Close suggestions when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('#citySuggestions') && !event.target.closest('#professionSuggestions')) {
        hideCitySuggestions();
        hideProfessionSuggestions();
      }
    });
    
    // Save profile function
    async function saveProfile() {
      // Check authentication more thoroughly
      if (!supabase) {
        showNotification('Supabase belum diinisialisasi. Silakan refresh halaman.', 'error');
        return;
      }
      
      if (!currentUser) {
        // Try to get current user from session or localStorage
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
          currentUser = session.user;
        } else {
          const isLoggedIn = localStorage.getItem('speakup_logged_in');
          const userId = localStorage.getItem('speakup_user_id');
          if (isLoggedIn === 'true' && userId) {
            currentUser = {
              id: userId,
              email: localStorage.getItem('speakup_user_email'),
              user_metadata: {
                full_name: localStorage.getItem('speakup_user_email')?.split('@')[0] || 'User'
              }
            };
          } else {
            showNotification('Anda belum login. Silakan login terlebih dahulu.', 'error');
            return;
          }
        }
      }
      
      console.log('Current user:', currentUser);
      console.log('Supabase client:', supabase);
      
      const formData = new FormData(document.getElementById('profileForm'));
      const data = Object.fromEntries(formData.entries());
      
      console.log('Form data:', data);
      console.log('Bio data:', data.bio);
      console.log('Display name:', data.displayName);
      console.log('Username:', data.username);
      
      try {
        // Upload avatar if changed
        let avatarUrl = null;
        const avatarFile = document.getElementById('avatarInput')?.files[0];
        if (avatarFile) {
          console.log('Uploading avatar file:', avatarFile.name);
          const avatarPath = `avatars/${currentUser.id}/${Date.now()}_${avatarFile.name}`;
          const { data: uploadData, error: uploadError } = await supabase.storage
            .from('profiles')
            .upload(avatarPath, avatarFile);
            
          if (uploadError) {
            console.error('Error uploading avatar:', uploadError);
            showNotification('Gagal mengupload foto profil: ' + uploadError.message, 'error');
          } else {
            const { data: { publicUrl } } = supabase.storage
              .from('profiles')
              .getPublicUrl(avatarPath);
            avatarUrl = publicUrl;
            console.log('Avatar uploaded successfully:', avatarUrl);
          }
        }
        
        // Upload banner if changed
        let bannerUrl = null;
        const bannerFile = document.getElementById('bannerInput')?.files[0];
        if (bannerFile) {
          console.log('Uploading banner file:', bannerFile.name);
          const bannerPath = `banners/${currentUser.id}/${Date.now()}_${bannerFile.name}`;
          const { data: uploadData, error: uploadError } = await supabase.storage
            .from('profiles')
            .upload(bannerPath, bannerFile);
            
          if (uploadError) {
            console.error('Error uploading banner:', uploadError);
            showNotification('Gagal mengupload banner: ' + uploadError.message, 'error');
          } else {
            const { data: { publicUrl } } = supabase.storage
              .from('profiles')
              .getPublicUrl(bannerPath);
            bannerUrl = publicUrl;
            console.log('Banner uploaded successfully:', bannerUrl);
          }
        }
        
        // Map privacy setting to identity
        let identity = 'custom_anon';
        if (data.privacy === 'anonymous') {
          identity = 'anonymous';
        } else if (data.privacy === 'verified') {
          identity = 'verified';
        }

        // Prepare profile data
        const profileData = {
          id: currentUser.id,
          full_name: data.displayName,
          username: data.username,
          title: data.title,
          bio: data.bio,
          location: data.location,
          website: data.website,
          privacy_profile: data.privacy || 'custom',
          identity: identity,
          updated_at: new Date().toISOString()
        };
        
        console.log('Saving profile data:', profileData);
        console.log('Username being saved:', data.username);
        
        // Add URLs if uploaded
        if (avatarUrl) {
          profileData.avatar_url = avatarUrl;
          console.log('Adding avatar URL to profile data:', avatarUrl);
        }
        if (bannerUrl) {
          profileData.banner_url = bannerUrl;
          console.log('Adding banner URL to profile data:', bannerUrl);
        }
        
        console.log('Profile data to save:', profileData);
        
        // Save to database - use update to avoid creating duplicates
        const { data: result, error } = await supabase
          .from('profiles')
          .update(profileData)
          .eq('id', currentUser.id);
          
        if (error) {
          console.error('Error saving profile:', error);
          showNotification('Gagal menyimpan profil: ' + error.message, 'error');
          return;
        }
        
        console.log('Profile saved successfully:', result);
        
        // Verify data was saved correctly
        console.log('Verifying saved data...');
        const { data: savedData, error: verifyError } = await supabase
          .from('profiles')
          .select('*')
          .eq('id', currentUser.id)
          .single();
          
        if (verifyError) {
          console.error('Error verifying saved data:', verifyError);
        } else {
          console.log('Verified saved data:', savedData);
          console.log('Bio in database after save:', savedData.bio);
        }
        
        showNotification('Profil berhasil disimpan!', 'success');
        
        // Redirect back to profile page
        setTimeout(() => {
          window.location.href = './profile-desktop.html';
        }, 1500);
        
      } catch (error) {
        console.error('Error saving profile:', error);
        showNotification('Gagal menyimpan profil: ' + error.message, 'error');
      }
    }
    
    // Notification function
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateX(100%);
        transition: transform 0.3s ease;
      `;
      
      // Set background color based on type
      switch (type) {
        case 'success':
          notification.style.backgroundColor = '#10b981';
          break;
        case 'error':
          notification.style.backgroundColor = '#ef4444';
          break;
        case 'warning':
          notification.style.backgroundColor = '#f59e0b';
          break;
        default:
          notification.style.backgroundColor = '#38bdf8';
      }
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 5000);
    }
    
    function updateNavigationForLoggedInUser() {
      console.log('Updating navigation for logged in user...');
      
      // Show all navigation items
      const navItems = document.querySelectorAll('.desktop-nav .nav-item');
      navItems.forEach(item => {
        item.style.display = 'flex';
      });
      
      // Convert Sign button to Logout button
      const signButton = document.getElementById('signButton');
      if (signButton) {
        console.log('Converting Sign button to Logout button');
        signButton.href = 'javascript:void(0)';
        signButton.onclick = logout;
        signButton.title = 'Logout';
        signButton.innerHTML = `
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
          </svg>
          <span>Logout</span>
        `;
      }
      
      // Show Speak! button
      const speakButton = document.querySelector('.plus-btn');
      if (speakButton) {
        speakButton.style.display = 'flex';
      }
      
      // Handle Profile button click to go to own profile
      const profileButton = document.querySelector('a[href="./profile-desktop.html"]');
      if (profileButton) {
        profileButton.addEventListener('click', function(e) {
          e.preventDefault();
          // Navigate to own profile (without URL parameter)
          window.location.href = 'profile-desktop.html';
        });
      }
    }
    
    // Logout handled globally in assets/js/app.js
    
    // Daftar profesi umum di Indonesia
    const indonesiaProfessions = [
      'Dokter', 'Dokter Gigi', 'Dokter Spesialis', 'Perawat', 'Bidan', 'Apoteker',
      'Guru', 'Dosen', 'Pengajar', 'Konsultan Pendidikan', 'Psikolog', 'Konselor',
      'Insinyur', 'Arsitek', 'Teknisi', 'Programmer', 'Developer', 'Data Scientist',
      'Akuntan', 'Konsultan Keuangan', 'Bankir', 'Analis Keuangan', 'Auditor',
      'Pengacara', 'Notaris', 'Hakim', 'Jaksa', 'Konsultan Hukum',
      'Wartawan', 'Editor', 'Penulis', 'Blogger', 'Content Creator', 'Youtuber',
      'Fotografer', 'Videografer', 'Desainer Grafis', 'UI/UX Designer', 'Web Designer',
      'Musisi', 'Seniman', 'Pelukis', 'Pemahat', 'Aktor', 'Sutradara', 'Produser',
      'Chef', 'Koki', 'Bartender', 'Manajer Restoran', 'Konsultan Kuliner',
      'Pilot', 'Pramugari', 'Sopir', 'Kapten Kapal', 'Masinis',
      'Polisi', 'Tentara', 'Satpam', 'Detektif', 'Konsultan Keamanan',
      'Manajer', 'CEO', 'Direktur', 'Supervisor', 'HR Manager', 'Marketing Manager',
      'Sales', 'Marketing', 'Public Relations', 'Event Organizer', 'Konsultan Bisnis',
      'Petani', 'Nelayan', 'Peternak', 'Konsultan Pertanian', 'Ahli Tanaman',
      'Peneliti', 'Ilmuwan', 'Ahli Kimia', 'Ahli Biologi', 'Ahli Fisika',
      'Penerjemah', 'Interpreter', 'Guide Wisata', 'Konsultan Pariwisata',
      'Freelancer', 'Konsultan', 'Entrepreneur', 'Startup Founder', 'Investor'
    ];

    // Fungsi untuk filter profesi berdasarkan input
    function filterProfessions(input) {
      const dropdown = document.getElementById('professionDropdown');
      const query = input.toLowerCase().trim();
      
      if (query.length < 1) {
        dropdown.style.display = 'none';
        return;
      }
      
      const filteredProfessions = indonesiaProfessions.filter(profession => 
        profession.toLowerCase().includes(query)
      );
      
      if (filteredProfessions.length === 0) {
        dropdown.style.display = 'none';
        return;
      }
      
      // Tampilkan dropdown
      dropdown.innerHTML = '';
      filteredProfessions.slice(0, 10).forEach((profession, index) => {
        const professionElement = document.createElement('div');
        professionElement.className = 'profession-option';
        professionElement.style.cssText = `
          padding: 12px 16px;
          cursor: pointer;
          border-bottom: 1px solid #f3f4f6;
          transition: background-color 0.2s;
          font-size: 14px;
        `;
        professionElement.textContent = profession;
        professionElement.onmouseover = function() {
          this.style.backgroundColor = '#f3f4f6';
        };
        professionElement.onmouseout = function() {
          this.style.backgroundColor = 'white';
        };
        professionElement.onclick = function() {
          selectProfession(profession);
        };
        dropdown.appendChild(professionElement);
      });
      
      dropdown.style.display = 'block';
      selectedProfessionIndex = -1;
    }

    function selectProfession(profession) {
      document.getElementById('title').value = profession;
      document.getElementById('professionDropdown').style.display = 'none';
    }

    function handleProfessionKeydown(event) {
      const dropdown = document.getElementById('professionDropdown');
      const options = dropdown.querySelectorAll('.profession-option');
      
      if (event.key === 'ArrowDown') {
        event.preventDefault();
        selectedProfessionIndex = Math.min(selectedProfessionIndex + 1, options.length - 1);
        updateProfessionSelection();
      } else if (event.key === 'ArrowUp') {
        event.preventDefault();
        selectedProfessionIndex = Math.max(selectedProfessionIndex - 1, -1);
        updateProfessionSelection();
      } else if (event.key === 'Enter') {
        event.preventDefault();
        if (selectedProfessionIndex >= 0 && options[selectedProfessionIndex]) {
          options[selectedProfessionIndex].click();
        }
      } else if (event.key === 'Escape') {
        dropdown.style.display = 'none';
        selectedProfessionIndex = -1;
      }
    }

    function updateProfessionSelection() {
      const dropdown = document.getElementById('professionDropdown');
      const options = dropdown.querySelectorAll('.profession-option');
      
      options.forEach((option, index) => {
        if (index === selectedProfessionIndex) {
          option.style.backgroundColor = '#e5e7eb';
        } else {
          option.style.backgroundColor = 'white';
        }
      });
    }

    // Fungsi untuk filter kota berdasarkan input
    function filterCities(input) {
      const dropdown = document.getElementById('locationDropdown');
      const query = input.toLowerCase().trim();
      
      if (query.length < 2) {
        dropdown.style.display = 'none';
        return;
      }
      
      const filteredCities = indonesiaCities.filter(city => 
        city.toLowerCase().includes(query)
      );
      
      if (filteredCities.length === 0) {
        dropdown.style.display = 'none';
        return;
      }
      
      // Tampilkan dropdown
      dropdown.innerHTML = '';
      filteredCities.slice(0, 10).forEach((city, index) => {
        const cityElement = document.createElement('div');
        cityElement.className = 'city-option';
        cityElement.style.cssText = `
          padding: 12px 16px;
          cursor: pointer;
          border-bottom: 1px solid #f3f4f6;
          transition: background-color 0.2s;
          font-size: 14px;
        `;
        cityElement.textContent = city;
        cityElement.onmouseover = function() {
          this.style.backgroundColor = '#f3f4f6';
        };
        cityElement.onmouseout = function() {
          this.style.backgroundColor = 'white';
        };
        cityElement.onclick = function() {
          selectCity(city);
        };
        dropdown.appendChild(cityElement);
      });
      
      dropdown.style.display = 'block';
      selectedCityIndex = -1;
    }
    
    // Fungsi untuk memilih kota
    function selectCity(city) {
      const locationInput = document.getElementById('location');
      const dropdown = document.getElementById('locationDropdown');
      
      locationInput.value = city;
      dropdown.style.display = 'none';
      selectedCityIndex = -1;
    }
    
    // Fungsi untuk handle keyboard navigation
    function handleLocationKeydown(event) {
      const dropdown = document.getElementById('locationDropdown');
      const cityOptions = dropdown.querySelectorAll('.city-option');
      
      if (dropdown.style.display === 'none') return;
      
      switch(event.key) {
        case 'ArrowDown':
          event.preventDefault();
          selectedCityIndex = Math.min(selectedCityIndex + 1, cityOptions.length - 1);
          updateCitySelection();
          break;
        case 'ArrowUp':
          event.preventDefault();
          selectedCityIndex = Math.max(selectedCityIndex - 1, -1);
          updateCitySelection();
          break;
        case 'Enter':
          event.preventDefault();
          if (selectedCityIndex >= 0 && cityOptions[selectedCityIndex]) {
            selectCity(cityOptions[selectedCityIndex].textContent);
          }
          break;
        case 'Escape':
          dropdown.style.display = 'none';
          selectedCityIndex = -1;
          break;
      }
    }
    
    // Fungsi untuk update selection visual
    function updateCitySelection() {
      const dropdown = document.getElementById('locationDropdown');
      const cityOptions = dropdown.querySelectorAll('.city-option');
      
      cityOptions.forEach((option, index) => {
        if (index === selectedCityIndex) {
          option.style.backgroundColor = '#38bdf8';
          option.style.color = 'white';
        } else {
          option.style.backgroundColor = 'white';
          option.style.color = '#374151';
        }
      });
    }
    
    // Hide dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const locationInput = document.getElementById('location');
      const dropdown = document.getElementById('locationDropdown');
      
      if (!locationInput.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.style.display = 'none';
        selectedCityIndex = -1;
      }
    });
    
    async function resetProfile() {
      // Check authentication more thoroughly
      if (!supabase) {
        showNotification('Supabase belum diinisialisasi. Silakan refresh halaman.', 'error');
        return;
      }
      
      if (!currentUser) {
        // Try to get current user from session or localStorage
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
          currentUser = session.user;
        } else {
          const isLoggedIn = localStorage.getItem('speakup_logged_in');
          const userId = localStorage.getItem('speakup_user_id');
          if (isLoggedIn === 'true' && userId) {
            currentUser = {
              id: userId,
              email: localStorage.getItem('speakup_user_email'),
              user_metadata: {
                full_name: localStorage.getItem('speakup_user_email')?.split('@')[0] || 'User'
              }
            };
          } else {
            showNotification('Anda belum login. Silakan login terlebih dahulu.', 'error');
            return;
          }
        }
      }
      
      if (!confirm('Apakah Anda yakin ingin mereset profil? Semua data akan dihapus.')) {
        return;
      }
      
      try {
        // Delete existing profile
        const { error: deleteError } = await supabase
          .from('profiles')
          .delete()
          .eq('id', currentUser.id);
          
        if (deleteError) {
          console.error('Error deleting profile:', deleteError);
          showNotification('Gagal menghapus profil lama', 'error');
          return;
        }
        
        // Create new empty profile
        const { data, error } = await supabase
          .from('profiles')
          .insert({
            id: currentUser.id,
            full_name: currentUser.user_metadata?.full_name || currentUser.email?.split('@')[0] || 'User',
            bio: '',
            avatar_url: null,
            banner_url: null,
            phone: null,
            location: null,
            website: null,
            created_at: new Date().toISOString()
          });
          
        // Clear file inputs
        document.getElementById('avatarInput').value = '';
        document.getElementById('bannerInput').value = '';
        
        // Clear avatar and banner display
        const avatar = document.getElementById('profileAvatar');
        if (avatar) {
          avatar.innerHTML = `
            <svg width="60" height="60" fill="currentColor" viewBox="0 0 20 20" style="color: #9ca3af;">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
          `;
        }
        
        const banner = document.getElementById('profileBanner');
        if (banner) {
          banner.style.background = 'linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)';
        }
          
        if (error) {
          console.error('Error creating profile:', error);
          showNotification('Gagal membuat profil baru', 'error');
          return;
        }
        
        showNotification('Profil berhasil direset!', 'success');
        
        // Redirect ke halaman profil
        setTimeout(() => {
          window.location.href = './profile-desktop.html';
        }, 1500);
        
      } catch (error) {
        console.error('Error resetting profile:', error);
        showNotification('Terjadi kesalahan saat mereset profil', 'error');
      }
    }


    function changeAvatar() {
      const hiddenInput = document.getElementById('avatarInput');
      hiddenInput.click();
      
      hiddenInput.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          openCropModal(file, 'avatar');
        }
      };
    }

    function changeBanner() {
      const hiddenInput = document.getElementById('bannerInput');
      
      // Clear previous event listeners
      hiddenInput.onchange = null;
      
      hiddenInput.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          console.log('Banner file selected:', file.name);
          openCropModal(file, 'banner');
        }
      };
      
      hiddenInput.click();
    }

    function resetProfile() {
      if (confirm('Apakah Anda yakin ingin mereset profil ke pengaturan default? Tindakan ini tidak dapat dibatalkan.')) {
        showNotification('Profil berhasil direset!', 'success');
        // Reset form values
        document.getElementById('displayName').value = 'Anonymous User';
        document.getElementById('username').value = '@anonymous';
        document.getElementById('title').value = '';
        document.getElementById('bio').value = 'Speak up for what matters';
        document.getElementById('location').value = '';
        document.getElementById('website').value = '';
        document.getElementById('privacy').value = 'anonymous';
        
        // Reset verified option state
        const verifiedOption = document.getElementById('verifiedOption');
        if (verifiedOption) {
          verifiedOption.disabled = true;
          verifiedOption.style.color = '#9ca3af';
          verifiedOption.textContent = 'Verified Account (Belum diverifikasi)';
        }
        
        // Clear file inputs
        document.getElementById('avatarInput').value = '';
        document.getElementById('bannerInput').value = '';
        
        // Reset avatar and banner display
        const avatar = document.getElementById('profileAvatar');
        if (avatar) {
          avatar.innerHTML = `
            <svg width="60" height="60" fill="currentColor" viewBox="0 0 20 20" style="color: #9ca3af;">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
          `;
        }
        
        const banner = document.getElementById('profileBanner');
        if (banner) {
          banner.style.background = 'linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)';
        }
      }
    }


    // Crop Modal Functions
    let currentCropType = '';
    let currentCropFile = null;
    let cropCanvas = null;
    let cropContext = null;
    // Instagram-style crop variables
    let isDragging = false;
    let dragStart = { x: 0, y: 0 };
    let cropArea = { x: 0, y: 0, width: 0, height: 0 };
    
    // Zoom and pan variables
    let currentZoom = 1;
    let minZoom = 1;
    let maxZoom = 3;
    let imageOffset = { x: 0, y: 0 };
    let isImageDragging = false;
    let lastTouchDistance = 0;
    let lastTouchCenter = { x: 0, y: 0 };
    
    // Container dimensions (fixed)
    const CONTAINER_WIDTH = 500;
    const CONTAINER_HEIGHT = 400;
    const AVATAR_CROP_SIZE = 250; // Square crop area for avatar
    const BANNER_CROP_WIDTH = 400; // Banner crop width
    const BANNER_CROP_HEIGHT = 100; // Banner crop height (4:1 ratio)

    function openCropModal(file, type) {
      currentCropType = type;
      currentCropFile = file;
      
      // Remove existing modal if exists
      const existingModal = document.querySelector('.crop-modal');
      if (existingModal) {
        existingModal.remove();
      }

      const modal = document.createElement('div');
      modal.className = 'crop-modal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease-out;
      `;

      modal.innerHTML = `
        <div style="background: #000; width: 100%; height: 100%; display: flex; flex-direction: column;">
          <!-- Instagram-style header -->
          <div style="display: flex; justify-content: center; align-items: center; padding: 16px 20px; background: rgba(0,0,0,0.8); border-bottom: 1px solid rgba(255,255,255,0.1);">
            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: white;">
              ${type === 'avatar' ? 'Edit Foto Profil' : 'Edit Banner'}
              </h3>
            </div>
          
          <!-- Instagram-style crop area -->
          <div style="flex: 1; display: flex; justify-content: center; align-items: center; position: relative; background: #000;">
            <div id="cropContainer" style="position: relative; width: ${CONTAINER_WIDTH}px; height: ${CONTAINER_HEIGHT}px; overflow: hidden; background: #000;">
              <!-- Image container with zoom and pan -->
              <div id="imageContainer" style="position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                <img id="cropImage" style="display: block; max-width: none; max-height: none; user-select: none; pointer-events: none; transform-origin: center center; transition: transform 0.1s ease-out;">
          </div>
          
              <!-- Instagram-style crop overlay -->
              <div id="cropOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                ${type === 'avatar' ? `
                  <!-- Avatar crop overlay (square) -->
                  <!-- Top overlay -->
                  <div style="position: absolute; top: 0; left: 0; width: 100%; height: ${(CONTAINER_HEIGHT - AVATAR_CROP_SIZE) / 2}px; background: rgba(0,0,0,0.5);"></div>
                  <!-- Bottom overlay -->
                  <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: ${(CONTAINER_HEIGHT - AVATAR_CROP_SIZE) / 2}px; background: rgba(0,0,0,0.5);"></div>
                  <!-- Left overlay -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - AVATAR_CROP_SIZE) / 2}px; left: 0; width: ${(CONTAINER_WIDTH - AVATAR_CROP_SIZE) / 2}px; height: ${AVATAR_CROP_SIZE}px; background: rgba(0,0,0,0.5);"></div>
                  <!-- Right overlay -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - AVATAR_CROP_SIZE) / 2}px; right: 0; width: ${(CONTAINER_WIDTH - AVATAR_CROP_SIZE) / 2}px; height: ${AVATAR_CROP_SIZE}px; background: rgba(0,0,0,0.5);"></div>
                  
                  <!-- Crop area border -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - AVATAR_CROP_SIZE) / 2}px; left: ${(CONTAINER_WIDTH - AVATAR_CROP_SIZE) / 2}px; width: ${AVATAR_CROP_SIZE}px; height: ${AVATAR_CROP_SIZE}px; border: 2px solid white; box-sizing: border-box; pointer-events: none;"></div>
                  
                  <!-- Zoom controls -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - AVATAR_CROP_SIZE) / 2 + 10}px; right: ${(CONTAINER_WIDTH - AVATAR_CROP_SIZE) / 2 + 10}px; display: flex; flex-direction: column; gap: 8px; pointer-events: all;">
                    <button id="zoomInBtn" onclick="zoomIn()" style="width: 40px; height: 40px; background: rgba(0,0,0,0.7); color: white; border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(0,0,0,0.9)'" onmouseout="this.style.background='rgba(0,0,0,0.7)'">+</button>
                    <button id="zoomOutBtn" onclick="zoomOut()" style="width: 40px; height: 40px; background: rgba(0,0,0,0.7); color: white; border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(0,0,0,0.9)'" onmouseout="this.style.background='rgba(0,0,0,0.7)'">-</button>
              </div>
                ` : `
                  <!-- Banner crop overlay (4:1 ratio) -->
                  <!-- Top overlay -->
                  <div style="position: absolute; top: 0; left: 0; width: 100%; height: ${(CONTAINER_HEIGHT - BANNER_CROP_HEIGHT) / 2}px; background: rgba(0,0,0,0.5);"></div>
                  <!-- Bottom overlay -->
                  <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: ${(CONTAINER_HEIGHT - BANNER_CROP_HEIGHT) / 2}px; background: rgba(0,0,0,0.5);"></div>
                  <!-- Left overlay -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - BANNER_CROP_HEIGHT) / 2}px; left: 0; width: ${(CONTAINER_WIDTH - BANNER_CROP_WIDTH) / 2}px; height: ${BANNER_CROP_HEIGHT}px; background: rgba(0,0,0,0.5);"></div>
                  <!-- Right overlay -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - BANNER_CROP_HEIGHT) / 2}px; right: 0; width: ${(CONTAINER_WIDTH - BANNER_CROP_WIDTH) / 2}px; height: ${BANNER_CROP_HEIGHT}px; background: rgba(0,0,0,0.5);"></div>
                  
                  <!-- Crop area border -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - BANNER_CROP_HEIGHT) / 2}px; left: ${(CONTAINER_WIDTH - BANNER_CROP_WIDTH) / 2}px; width: ${BANNER_CROP_WIDTH}px; height: ${BANNER_CROP_HEIGHT}px; border: 2px solid white; box-sizing: border-box; pointer-events: none;"></div>
                  
                  <!-- Zoom controls -->
                  <div style="position: absolute; top: ${(CONTAINER_HEIGHT - BANNER_CROP_HEIGHT) / 2 + 10}px; right: ${(CONTAINER_WIDTH - BANNER_CROP_WIDTH) / 2 + 10}px; display: flex; flex-direction: column; gap: 8px; pointer-events: all;">
                    <button id="zoomInBtn" onclick="zoomIn()" style="width: 40px; height: 40px; background: rgba(0,0,0,0.7); color: white; border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(0,0,0,0.9)'" onmouseout="this.style.background='rgba(0,0,0,0.7)'">+</button>
                    <button id="zoomOutBtn" onclick="zoomOut()" style="width: 40px; height: 40px; background: rgba(0,0,0,0.7); color: white; border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(0,0,0,0.9)'" onmouseout="this.style.background='rgba(0,0,0,0.7)'">-</button>
            </div>
                `}
          </div>
            </div>
          </div>
          
          <!-- Action buttons -->
          <div style="padding: 20px; background: rgba(0,0,0,0.8); display: flex; justify-content: center; gap: 16px;">
            <button onclick="closeCropModal()" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">Batal</button>
            <button onclick="applyCrop()" style="background: #38bdf8; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#0ea5e9'" onmouseout="this.style.background='#38bdf8'">Selesai</button>
          </div>
          
          <!-- Instagram-style instructions -->
          <div style="padding: 0 20px 20px; background: rgba(0,0,0,0.8); text-align: center;">
            <p style="margin: 0; color: white; font-size: 14px; opacity: 0.8;">
              ${type === 'avatar' ? 'Geser dan zoom untuk menyesuaikan foto profil' : 'Geser dan zoom untuk menyesuaikan banner'}
            </p>
            <p style="margin: 4px 0 0; color: white; font-size: 12px; opacity: 0.6;">
              Gunakan tombol + dan - untuk zoom â€¢ Drag untuk menggeser
            </p>
          </div>
        </div>
      `;

      document.body.appendChild(modal);



      // Load image and setup Instagram-style crop
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = document.getElementById('cropImage');
        img.src = e.target.result;
        
        img.onload = function() {
          // Initialize Instagram-style crop system
          initializeInstagramCrop(img, type);
        };
      };
      reader.readAsDataURL(file);
    }

    function resizeImage(originalWidth, originalHeight, maxWidth, maxHeight) {
      let width = originalWidth;
      let height = originalHeight;
      
      // Calculate aspect ratio
      const aspectRatio = width / height;
      
      // Resize based on the limiting dimension
      if (width > maxWidth) {
        width = maxWidth;
        height = width / aspectRatio;
      }
      
      if (height > maxHeight) {
        height = maxHeight;
        width = height * aspectRatio;
      }
      
      return { width: Math.round(width), height: Math.round(height) };
    }

    /**
     * Initialize Instagram-style crop system
     * Sets up zoom, pan, and boundary constraints
     */
    function initializeInstagramCrop(img, type) {
      console.log('Initializing Instagram-style crop for', type);
      
      // Calculate initial image size to fit container
      const containerAspectRatio = CONTAINER_WIDTH / CONTAINER_HEIGHT;
      const imageAspectRatio = img.naturalWidth / img.naturalHeight;
      
      let initialWidth, initialHeight;
      
      if (imageAspectRatio > containerAspectRatio) {
        // Image is wider than container - fit by width
        initialWidth = CONTAINER_WIDTH;
        initialHeight = CONTAINER_WIDTH / imageAspectRatio;
      } else {
        // Image is taller than container - fit by height
        initialHeight = CONTAINER_HEIGHT;
        initialWidth = CONTAINER_HEIGHT * imageAspectRatio;
      }
      
      // Set initial image size
      img.style.width = initialWidth + 'px';
      img.style.height = initialHeight + 'px';
      
      // Calculate minimum zoom using the correct formula
      // minScale = Math.max(cropWidth / imageWidth, cropHeight / imageHeight)
      const cropWidth = type === 'avatar' ? AVATAR_CROP_SIZE : BANNER_CROP_WIDTH;
      const cropHeight = type === 'avatar' ? AVATAR_CROP_SIZE : BANNER_CROP_HEIGHT;
      const minScaleX = cropWidth / initialWidth;
      const minScaleY = cropHeight / initialHeight;
      minZoom = Math.max(minScaleX, minScaleY);
      
      // Set zoom constraints
      maxZoom = 4; // Maximum 4x zoom
      currentZoom = minZoom; // Start at minimum zoom
      
      // Reset image offset
        imageOffset = { x: 0, y: 0 };
      
      // Apply initial transform
      applyImageTransform();
      
      // Setup event listeners for Instagram-style interactions
      setupInstagramEventListeners(img);
      
      console.log('Instagram crop initialized:', {
        initialSize: { width: initialWidth, height: initialHeight },
        zoomRange: { min: minZoom, max: maxZoom, current: currentZoom },
        minScaleCalculation: { x: minScaleX, y: minScaleY, final: minZoom },
        imageAspectRatio,
        containerAspectRatio
      });
    }

    /**
     * Apply zoom and pan transform to image
     * Ensures image stays within boundary constraints and always fills crop area
     */
    function applyImageTransform() {
      const img = document.getElementById('cropImage');
      if (!img) return;
      
      // Calculate current image dimensions
      const baseWidth = parseFloat(img.style.width);
      const baseHeight = parseFloat(img.style.height);
      const scaledWidth = baseWidth * currentZoom;
      const scaledHeight = baseHeight * currentZoom;
      
      // Calculate crop area position based on type
      const cropWidth = currentCropType === 'avatar' ? AVATAR_CROP_SIZE : BANNER_CROP_WIDTH;
      const cropHeight = currentCropType === 'avatar' ? AVATAR_CROP_SIZE : BANNER_CROP_HEIGHT;
      const cropAreaX = (CONTAINER_WIDTH - cropWidth) / 2;
      const cropAreaY = (CONTAINER_HEIGHT - cropHeight) / 2;
      
      // Calculate maximum allowed offset to ensure crop area is always filled
      // The image must cover the entire crop area, so we need to ensure:
      // 1. Image left edge is at or left of crop area left edge
      // 2. Image right edge is at or right of crop area right edge
      // 3. Image top edge is at or above crop area top edge
      // 4. Image bottom edge is at or below crop area bottom edge
      
      const imageCenterX = CONTAINER_WIDTH / 2;
      const imageCenterY = CONTAINER_HEIGHT / 2;
      
      // Calculate the maximum offset that still keeps the crop area filled
      const maxOffsetX = Math.max(0, (scaledWidth - cropWidth) / 2);
      const maxOffsetY = Math.max(0, (scaledHeight - cropHeight) / 2);
      
      // Constrain offset within bounds
      imageOffset.x = Math.max(-maxOffsetX, Math.min(maxOffsetX, imageOffset.x));
      imageOffset.y = Math.max(-maxOffsetY, Math.min(maxOffsetY, imageOffset.y));
      
      // Apply transform with center origin
      img.style.transformOrigin = 'center center';
      img.style.transform = `scale(${currentZoom}) translate(${imageOffset.x}px, ${imageOffset.y}px)`;
      
      // Update button states
      updateZoomButtonStates();
      
      console.log('Transform applied:', {
        zoom: currentZoom,
        offset: imageOffset,
        scaledSize: { width: scaledWidth, height: scaledHeight },
        maxOffset: { x: maxOffsetX, y: maxOffsetY },
        cropArea: { x: cropAreaX, y: cropAreaY, width: cropWidth, height: cropHeight }
      });
    }

    /**
     * Setup event listeners for Instagram-style interactions
     * Handles mouse drag pan and touch gestures (zoom removed, using buttons instead)
     */
    function setupInstagramEventListeners(img) {
      const container = document.getElementById('cropContainer');
      
      // Mouse drag to pan image
      let isDragging = false;
      let lastMousePos = { x: 0, y: 0 };
      
      container.addEventListener('mousedown', function(e) {
        if (currentZoom > minZoom) { // Only allow drag when zoomed in
          isDragging = true;
          lastMousePos = { x: e.clientX, y: e.clientY };
          container.style.cursor = 'grabbing';
          e.preventDefault();
        }
      });
      
      document.addEventListener('mousemove', function(e) {
        if (isDragging) {
          const deltaX = e.clientX - lastMousePos.x;
          const deltaY = e.clientY - lastMousePos.y;
          
          imageOffset.x += deltaX;
          imageOffset.y += deltaY;
          
          applyImageTransform();
          
          lastMousePos = { x: e.clientX, y: e.clientY };
        }
      });
      
      document.addEventListener('mouseup', function() {
        if (isDragging) {
          isDragging = false;
          container.style.cursor = currentZoom > minZoom ? 'grab' : 'default';
        }
      });
      
      // Touch support for mobile (pan only, no pinch zoom)
      container.addEventListener('touchstart', function(e) {
        e.preventDefault();
        
        if (e.touches.length === 1) {
          // Single touch - start pan
          isDragging = true;
          lastMousePos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
        }
      });
      
      container.addEventListener('touchmove', function(e) {
        e.preventDefault();
        
        if (e.touches.length === 1 && isDragging) {
          // Single touch pan
          const deltaX = e.touches[0].clientX - lastMousePos.x;
          const deltaY = e.touches[0].clientY - lastMousePos.y;
          
          imageOffset.x += deltaX;
          imageOffset.y += deltaY;
          
          applyImageTransform();
          
          lastMousePos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
        }
      });
      
      container.addEventListener('touchend', function(e) {
        if (e.touches.length === 0) {
          isDragging = false;
        }
      });
      
      // Set initial cursor
      container.style.cursor = currentZoom > minZoom ? 'grab' : 'default';
    }

    /**
     * Zoom in function - called by + button
     * Increases zoom by 0.1 and ensures proper centering
     */
    function zoomIn() {
      const newZoom = Math.min(maxZoom, currentZoom + 0.1);
      
      if (newZoom !== currentZoom) {
        currentZoom = newZoom;
        applyImageTransform();
        console.log('Zoom in to:', currentZoom);
      }
    }

    /**
     * Zoom out function - called by - button
     * Decreases zoom by 0.1 and ensures proper centering
     */
    function zoomOut() {
      const newZoom = Math.max(minZoom, currentZoom - 0.1);
      
      if (newZoom !== currentZoom) {
        currentZoom = newZoom;
        applyImageTransform();
        console.log('Zoom out to:', currentZoom);
      }
    }

    /**
     * Update zoom button states based on current zoom level
     * Disables buttons when at min/max zoom
     */
    function updateZoomButtonStates() {
      const zoomInBtn = document.getElementById('zoomInBtn');
      const zoomOutBtn = document.getElementById('zoomOutBtn');
      
      if (zoomInBtn && zoomOutBtn) {
        // Disable zoom in button if at max zoom
        if (currentZoom >= maxZoom) {
          zoomInBtn.style.opacity = '0.5';
          zoomInBtn.style.cursor = 'not-allowed';
          zoomInBtn.disabled = true;
        } else {
          zoomInBtn.style.opacity = '1';
          zoomInBtn.style.cursor = 'pointer';
          zoomInBtn.disabled = false;
        }
        
        // Disable zoom out button if at min zoom
        if (currentZoom <= minZoom) {
          zoomOutBtn.style.opacity = '0.5';
          zoomOutBtn.style.cursor = 'not-allowed';
          zoomOutBtn.disabled = true;
        } else {
          zoomOutBtn.style.opacity = '1';
          zoomOutBtn.style.cursor = 'pointer';
          zoomOutBtn.disabled = false;
        }
      }
    }
    







    function updateCropAreaPosition() {
      const img = document.getElementById('cropImage');
      const cropArea = document.getElementById('cropArea');
      
      if (!img || !cropArea) return;
      
      // Get current crop area dimensions
      const cropWidth = parseInt(cropArea.style.width) || 200;
      const cropHeight = parseInt(cropArea.style.height) || 200;
      
      // Calculate the center position of the container
      const imgWidth = img.offsetWidth;
      const imgHeight = img.offsetHeight;
      
      // Always position crop area at the center of the container
      const x = (imgWidth - cropWidth) / 2;
      const y = (imgHeight - cropHeight) / 2;
      
      cropArea.style.left = x + 'px';
      cropArea.style.top = y + 'px';
    }

    function setupCropArea(img, aspectRatio, cropSize) {
      const container = img.parentElement;
      const overlay = document.getElementById('cropOverlay');
      const cropArea = document.getElementById('cropArea');
      
      // Wait for image to load and get its actual dimensions
      img.onload = function() {
        // Get the actual displayed dimensions of the image
        const imgWidth = img.offsetWidth;
        const imgHeight = img.offsetHeight;
        
        console.log('Image dimensions:', { imgWidth, imgHeight, aspectRatio });
        
        // Calculate crop area size based on image size and aspect ratio
        let cropWidth, cropHeight;
        if (aspectRatio > 1) {
          // Landscape crop (banner)
          cropWidth = Math.min(cropSize, imgWidth * 0.8);
          cropHeight = cropWidth / aspectRatio;
        } else {
          // Square crop (avatar)
          cropHeight = Math.min(cropSize, imgHeight * 0.8);
          cropWidth = cropHeight * aspectRatio;
        }
        
        // Ensure crop area doesn't exceed image bounds
        cropWidth = Math.min(cropWidth, imgWidth);
        cropHeight = Math.min(cropHeight, imgHeight);
        
        // Center the crop area
        const x = (imgWidth - cropWidth) / 2;
        const y = (imgHeight - cropHeight) / 2;
        
        cropArea.style.left = x + 'px';
        cropArea.style.top = y + 'px';
        cropArea.style.width = cropWidth + 'px';
        cropArea.style.height = cropHeight + 'px';
        
        console.log('Crop area set:', { x, y, cropWidth, cropHeight });
        
        // Make crop area draggable
        makeCropAreaDraggable(cropArea, img);
      };
      
      // If image is already loaded, trigger the onload
      if (img.complete) {
        img.onload();
      }
    }

    function makeCropAreaDraggable(cropArea, containerWidth, containerHeight, cropWidth, cropHeight) {
      cropArea.addEventListener('mousedown', function(e) {
        console.log('Crop area mousedown - Instagram style');
        isDragging = true;
        const container = document.getElementById('imageContainer');
        const rect = container.getBoundingClientRect();
        dragStart.x = e.clientX - rect.left - parseInt(cropArea.style.left);
        dragStart.y = e.clientY - rect.top - parseInt(cropArea.style.top);
        e.preventDefault();
        e.stopPropagation();
      });

      document.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        
        const container = document.getElementById('imageContainer');
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left - dragStart.x;
        const y = e.clientY - rect.top - dragStart.y;
        
        // Instagram-style bounds - crop area can move anywhere in container
        const minX = 0;
        const minY = 0;
        const maxX = containerWidth - cropWidth;
        const maxY = containerHeight - cropHeight;
        
        // Constrain position within container
        const constrainedX = Math.max(minX, Math.min(x, maxX));
        const constrainedY = Math.max(minY, Math.min(y, maxY));
        
        cropArea.style.left = constrainedX + 'px';
        cropArea.style.top = constrainedY + 'px';
        
        console.log('Instagram-style crop area moved to:', { x: constrainedX, y: constrainedY });
      });

      document.addEventListener('mouseup', function() {
        if (isDragging) {
          console.log('Crop area drag ended');
          isDragging = false;
        }
      });
    }

    /**
     * Apply Instagram-style crop
     * Crops the image based on the visible crop area, accounting for zoom and pan
     */
    function applyCrop() {
      const img = document.getElementById('cropImage');
      if (!img) return;
      
      console.log('=== INSTAGRAM-STYLE CROP ===');
      console.log('Current zoom:', currentZoom);
      console.log('Image offset:', imageOffset);
      console.log('Image natural size:', { width: img.naturalWidth, height: img.naturalHeight });
      
      // Create canvas for cropping
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      // Calculate the visible crop area in the center of the container
      const cropWidth = currentCropType === 'avatar' ? AVATAR_CROP_SIZE : BANNER_CROP_WIDTH;
      const cropHeight = currentCropType === 'avatar' ? AVATAR_CROP_SIZE : BANNER_CROP_HEIGHT;
      const cropAreaX = (CONTAINER_WIDTH - cropWidth) / 2;
      const cropAreaY = (CONTAINER_HEIGHT - cropHeight) / 2;
      
      console.log('Crop area position:', { x: cropAreaX, y: cropAreaY, width: cropWidth, height: cropHeight });
      
      // Calculate the base image size (without zoom)
      const baseWidth = parseFloat(img.style.width);
      const baseHeight = parseFloat(img.style.height);
      
      console.log('Base image size:', { width: baseWidth, height: baseHeight });
      
      // Calculate the image position within the container
      // The image is centered in the container, then transformed by zoom and offset
      const imageCenterX = CONTAINER_WIDTH / 2;
      const imageCenterY = CONTAINER_HEIGHT / 2;
      
      // Calculate the top-left corner of the image after transform
      const imageTopLeftX = imageCenterX - (baseWidth * currentZoom) / 2 + imageOffset.x;
      const imageTopLeftY = imageCenterY - (baseHeight * currentZoom) / 2 + imageOffset.y;
      
      console.log('Image position after transform:', { 
        center: { x: imageCenterX, y: imageCenterY },
        topLeft: { x: imageTopLeftX, y: imageTopLeftY }
      });
      
      // Calculate the crop area position relative to the transformed image
      const cropRelativeToImageX = cropAreaX - imageTopLeftX;
      const cropRelativeToImageY = cropAreaY - imageTopLeftY;
      
      console.log('Crop area relative to transformed image:', { 
        x: cropRelativeToImageX, 
        y: cropRelativeToImageY 
      });
      
      // Convert to natural image coordinates
      // First, convert from transformed coordinates to base image coordinates
      const baseCropX = cropRelativeToImageX / currentZoom;
      const baseCropY = cropRelativeToImageY / currentZoom;
      const baseCropWidth = cropWidth / currentZoom;
      const baseCropHeight = cropHeight / currentZoom;
      
      console.log('Crop area in base image coordinates:', { 
        x: baseCropX, 
        y: baseCropY, 
        width: baseCropWidth,
        height: baseCropHeight
      });
      
      // Then convert to natural image coordinates
      const scaleX = img.naturalWidth / baseWidth;
      const scaleY = img.naturalHeight / baseHeight;
      
      const naturalCropX = baseCropX * scaleX;
      const naturalCropY = baseCropY * scaleY;
      const naturalCropWidth = baseCropWidth * scaleX;
      const naturalCropHeight = baseCropHeight * scaleY;
      
      console.log('Natural crop coordinates:', { 
        x: naturalCropX, 
        y: naturalCropY, 
        width: naturalCropWidth,
        height: naturalCropHeight
      });
      
      // Ensure crop coordinates are within image bounds
      const clampedCropX = Math.max(0, Math.min(naturalCropX, img.naturalWidth - naturalCropWidth));
      const clampedCropY = Math.max(0, Math.min(naturalCropY, img.naturalHeight - naturalCropHeight));
      const clampedCropWidth = Math.min(naturalCropWidth, img.naturalWidth - clampedCropX);
      const clampedCropHeight = Math.min(naturalCropHeight, img.naturalHeight - clampedCropY);
      
      console.log('Clamped crop coordinates:', { 
        x: clampedCropX, 
        y: clampedCropY, 
        width: clampedCropWidth,
        height: clampedCropHeight
      });
      
      // Set canvas size to desired output size
      const outputSize = currentCropType === 'avatar' ? 400 : 1200;
      canvas.width = outputSize;
      canvas.height = currentCropType === 'avatar' ? outputSize : outputSize / 4; // 4:1 ratio for banner
      
      // Enable image smoothing for better quality
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      
      // Draw the cropped image
      ctx.drawImage(
        img,
        clampedCropX, clampedCropY, clampedCropWidth, clampedCropHeight,
        0, 0, canvas.width, canvas.height
      );
      
      console.log('Canvas drawn with Instagram-style crop');
      
      // Convert to blob and update display
      canvas.toBlob(function(blob) {
        const reader = new FileReader();
        reader.onload = function(e) {
          if (currentCropType === 'avatar') {
            const avatar = document.getElementById('profileAvatar');
            avatar.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            // Update hidden input with cropped image
            updateHiddenInput(blob, 'avatarInput');
          } else {
            const banner = document.getElementById('profileBanner');
            banner.style.background = `url('${e.target.result}') center/contain`;
            banner.style.backgroundSize = 'contain';
            banner.style.backgroundPosition = 'center';
            banner.style.backgroundRepeat = 'no-repeat';
            // Update hidden input with cropped image
            updateHiddenInput(blob, 'bannerInput');
            console.log('Banner preview updated:', e.target.result);
          }
          showNotification(`${currentCropType === 'avatar' ? 'Foto profil' : 'Banner'} berhasil diubah!`, 'success');
          closeCropModal();
        };
        reader.readAsDataURL(blob);
      }, 'image/jpeg', 0.95);
    }

    function updateHiddenInput(blob, inputId) {
      const input = document.getElementById(inputId);
      const file = new File([blob], 'cropped-image.jpg', { type: 'image/jpeg' });
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      input.files = dataTransfer.files;
    }

    function closeCropModal() {
      const modal = document.querySelector('.crop-modal');
      if (modal) {
        
        modal.style.animation = 'fadeOut 0.3s ease-in';
        setTimeout(() => {
          if (modal.parentNode) {
            modal.remove();
          }
        }, 300);
      }
    }

    function showNotification(message, type = 'info') {
      // Unified toast style (bottom-center), consistent across all pages
      const hostId = 'su-toast-host';
      let host = document.getElementById(hostId);
      if (!host) {
        host = document.createElement('div');
        host.id = hostId;
        host.style.cssText = `
          position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%);
          display: flex; flex-direction: column; gap: 8px; align-items: center;
          z-index: 10000; pointer-events: none;`;
        document.body.appendChild(host);
      }

      const toast = document.createElement('div');
      toast.style.cssText = `
        background: #111827; color: #ffffff; border-radius: 9999px;
        padding: 10px 14px; font-size: 13px; font-weight: 500;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.08);
        opacity: 0; transform: translateY(8px); transition: all .25s ease;
        pointer-events: auto; white-space: nowrap; max-width: 90vw; overflow: hidden; text-overflow: ellipsis;`;

      // Accent dot
      const dot = document.createElement('span');
      dot.style.cssText = 'display:inline-block;width:8px;height:8px;border-radius:9999px;margin-right:8px;vertical-align:middle;';
      if (type === 'success') dot.style.background = '#10b981';
      else if (type === 'error') dot.style.background = '#ef4444';
      else if (type === 'warning') dot.style.background = '#f59e0b';
      else dot.style.background = '#60a5fa';

      const text = document.createElement('span');
      text.textContent = message;

      toast.appendChild(dot);
      toast.appendChild(text);
      host.appendChild(toast);

      // Animate in
      requestAnimationFrame(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)';
      });

      // Auto remove
      const lifetimeMs = 2400;
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(8px)';
          setTimeout(() => {
          if (toast.parentNode) toast.parentNode.removeChild(toast);
        }, 250);
      }, lifetimeMs);
    }

    // Character counter for bio
    document.getElementById('bio').addEventListener('input', function() {
      const maxLength = 150;
      const currentLength = this.value.length;
      const counter = document.getElementById('bioCounter') || document.createElement('span');
      counter.id = 'bioCounter';
      counter.style.cssText = 'font-size: 12px; color: #6b7280; margin-top: 4px; display: block;';
      counter.textContent = `${currentLength}/${maxLength}`;
      
      if (currentLength > maxLength) {
        counter.style.color = '#ef4444';
      } else {
        counter.style.color = '#6b7280';
      }
      
      if (!this.parentNode.querySelector('#bioCounter')) {
        this.parentNode.appendChild(counter);
      }
    });

    // CSS untuk animasi
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);

    // Clean up any remaining badge elements
    function cleanupBadgeElements() {
      // Remove any elements with badge-related classes or IDs
      const badgeSelectors = [
        '.profession-badge',
        '.professional-badge', 
        '.badge',
        '#profession-badge',
        '#professional-badge',
        '#badge'
      ];
      
      badgeSelectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(el => el.remove());
      });
      
      // Also remove any elements that might have been created dynamically
      const allElements = document.querySelectorAll('*');
      allElements.forEach(el => {
        if (el.className && el.className.includes('badge')) {
          el.remove();
        }
        if (el.id && el.id.includes('badge')) {
          el.remove();
        }
      });
      
      // Remove any elements that might be positioned near the title input
      const titleInput = document.getElementById('title');
      if (titleInput) {
        const parent = titleInput.parentElement;
        if (parent) {
          const siblings = Array.from(parent.parentElement.children);
          siblings.forEach(sibling => {
            if (sibling !== parent && sibling.textContent && 
                (sibling.textContent.includes('badge') || 
                 sibling.textContent.includes('Badge') ||
                 sibling.className.includes('badge') ||
                 sibling.id.includes('badge'))) {
              sibling.remove();
            }
          });
        }
      }
    }

    // Run cleanup when DOM is ready
    document.addEventListener('DOMContentLoaded', cleanupBadgeElements);
    
    // Also run cleanup after a short delay to catch any dynamically created elements
    setTimeout(cleanupBadgeElements, 1000);
  </script>

  <script src="assets/js/app.js"></script>
  <!-- Supabase SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="config/supabase-config.js"></script>
  <script src="config/supabase-bootstrap.js"></script>
  </body>
</html>
