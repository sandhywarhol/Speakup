<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="theme-color" content="#38bdf8" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>SpeakUp! — Buat Petisi</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="stylesheet" href="./phone-frame-template.css" />
</head>
<body>
  <div class="phone-frame">
    <!-- Notch simulation -->
    <div class="notch"></div>
    
    <!-- Status bar -->
    <div class="status-bar">
      <div class="status-left">
        <span class="status-time">9:41</span>
      </div>
      <div class="status-right">
        <div class="status-battery"></div>
      </div>
    </div>
    
    <!-- Phone screen content -->
    <div class="phone-screen">
      <div class="mobile-container">
        <main class="mobile-main">
  <div class="container" style="padding-top: 20px;">
    <div class="row space">
      <div class="logo">
        <img src="assets/logo/logo speak up blue.png" alt="SpeakUp!" data-theme="light" />
        <img src="assets/logo/logo speak up white.png" alt="SpeakUp!" data-theme="dark" />
      </div>
      <a href="./petitions.html" class="btn ghost">← Kembali</a>
    </div>
    <h2 style="margin-top: 16px;">🚀 Yuk, Suarakan Aspirasimu!</h2>
    <p class="content" style="margin-top: 8px; color: var(--muted); font-size: 14px;">
      Ceritakan masalahmu dan mari kita buat perubahan bersama-sama ✊
    </p>
  </div>

  <main class="container">
    <form id="createPetitionForm" class="mt-16">
      <!-- Step 1: Ceritakan Masalahmu -->
      <div class="card" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border: none; padding: 20px 22px;">
        <h3 style="margin-bottom: 8px; color: #1e293b; font-size: 18px;">💬 Ceritakan Masalahmu</h3>
        <p style="color: var(--muted); font-size: 13px; margin-bottom: 20px;">Jangan khawatir, kita akan bantu kamu menyuarakan ini!</p>
        
        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Apa masalah yang ingin kamu angkat? ✨</label>
          <input type="text" name="title" required maxlength="100" placeholder="Misal: Stop bullying di sekolahku!" style="margin-top: 6px;">
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Ceritakan kronologi masalahnya 📝</label>
          <textarea name="description" rows="5" required maxlength="2000" placeholder="Ceritakan apa yang terjadi, kapan, dimana, dan bagaimana dampaknya ke kamu atau orang lain..." style="margin-top: 6px;"></textarea>
          <div style="font-size: 11px; color: var(--muted); margin-top: 4px;">💡 Tip: Semakin detail ceritamu, semakin kuat petisimu!</div>
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Siapa yang bisa menyelesaikan masalah ini? 🎯</label>
          <input type="text" name="target" required placeholder="Misal: Kepala Sekolah, Rektor, Walikota..." style="margin-top: 6px;">
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Apa solusi yang kamu inginkan? 💡</label>
          <textarea name="solution" rows="3" required maxlength="1000" placeholder="Misal: Buat kebijakan anti-bullying yang tegas, adakan sosialisasi..." style="margin-top: 6px;"></textarea>
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Kategori masalah 🏷️</label>
          <select name="category" required style="margin-top: 6px;">
            <option value="">Pilih kategori yang paling sesuai</option>
            <option value="bullying">🎭 Bullying/Perundungan</option>
            <option value="workplace">🏢 Masalah di Tempat Kerja</option>
            <option value="education">📚 Pendidikan</option>
            <option value="discrimination">⚖️ Diskriminasi</option>
            <option value="corruption">🚫 Korupsi</option>
            <option value="environment">🌱 Lingkungan</option>
            <option value="other">📋 Lainnya</option>
          </select>
        </div>
      </div>

      <!-- Step 2: Verifikasi Diri -->
      <div class="card mt-16" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none; padding: 20px 22px;">
        <h3 style="margin-bottom: 8px; color: #92400e; font-size: 18px;">🛡️ Verifikasi Diri</h3>
        <p style="color: #a16207; font-size: 13px; margin-bottom: 20px;">
          Tenang aja! Data kamu aman dan cuma dipakai untuk verifikasi 🔒
        </p>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Nama lengkap kamu 👤</label>
          <input type="text" name="full_name" required placeholder="Sesuai yang ada di KTP ya" style="margin-top: 6px;">
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">NIK (16 digit) 🆔</label>
          <input type="text" name="nik" required pattern="[0-9]{16}" maxlength="16" placeholder="Nomor di KTP kamu" style="margin-top: 6px;">
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Foto KTP 📷</label>
          <div style="font-size: 11px; color: var(--muted); margin-bottom: 8px;">Pastikan foto jelas dan bisa dibaca ya!</div>
          <div class="file-upload-container">
            <input type="file" id="ktpUpload" name="ktp" accept="image/*" required>
            <button type="button" class="btn" onclick="document.getElementById('ktpUpload').click()" style="background: #fbbf24; color: #92400e; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 500;">
              📸 Ambil/Upload Foto KTP
            </button>
            <div id="ktpPreview" class="image-preview">
              <img id="ktpImg" style="border-radius: 8px; max-width: 100%; margin-top: 8px;">
              <button type="button" onclick="removeKTP()" class="btn ghost remove-btn" style="margin-top: 8px;">❌ Hapus</button>
            </div>
          </div>
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Nomor HP 📱</label>
          <input type="tel" name="phone" required placeholder="08xxxxxxxxxx" style="margin-top: 6px;">
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Email 📧</label>
          <input type="email" name="email" required placeholder="email@contoh.com" style="margin-top: 6px;">
        </div>
      </div>

      <!-- Step 3: Bukti Pendukung (Opsional) -->
      <div class="card mt-16" style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: none; padding: 20px 22px;">
        <h3 style="margin-bottom: 8px; color: #065f46; font-size: 18px;">📸 Punya Bukti? Upload Yuk!</h3>
        <p style="color: #047857; font-size: 13px; margin-bottom: 20px;">
          Bukti akan bikin petisimu lebih kuat! Tapi gak wajib kok 😊
        </p>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Foto/Screenshot 📷</label>
          <div style="font-size: 11px; color: var(--muted); margin-bottom: 8px;">Chat, foto, atau screenshot apapun yang mendukung ceritamu</div>
          <div class="file-upload-container">
            <input type="file" id="evidencePhotos" name="evidence_photos" accept="image/*" multiple>
            <button type="button" class="btn" onclick="document.getElementById('evidencePhotos').click()" style="background: #10b981; color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 500;">
              📷 Upload Foto (Maks 5)
            </button>
            <div id="photosPreview" class="image-preview">
              <div id="photosList"></div>
              <button type="button" onclick="removePhotos()" class="btn ghost remove-btn" style="display: none;">❌ Hapus Semua</button>
            </div>
          </div>
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Video (Opsional) 🎥</label>
          <div style="font-size: 11px; color: var(--muted); margin-bottom: 8px;">Punya video? Boleh juga! Maks 50MB ya</div>
          <div class="file-upload-container">
            <input type="file" id="evidenceVideo" name="evidence_video" accept="video/*">
            <button type="button" class="btn" onclick="document.getElementById('evidenceVideo').click()" style="background: #10b981; color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 500;">
              🎥 Upload Video
            </button>
            <div id="videoPreview" class="image-preview">
              <video id="videoElement" controls style="max-width: 100%; display: none; border-radius: 8px; margin-top: 8px;"></video>
              <button type="button" onclick="removeVideo()" class="btn ghost remove-btn" style="display: none;">❌ Hapus Video</button>
            </div>
          </div>
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Dokumen (Opsional) 📄</label>
          <div style="font-size: 11px; color: var(--muted); margin-bottom: 8px;">Surat, laporan, atau dokumen lain yang relevan</div>
          <div class="file-upload-container">
            <input type="file" id="documents" name="documents" accept=".pdf,.doc,.docx" multiple>
            <button type="button" class="btn" onclick="document.getElementById('documents').click()" style="background: #10b981; color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 500;">
              📄 Upload Dokumen (Maks 3)
            </button>
            <div id="documentsPreview" class="image-preview">
              <div id="documentsList"></div>
              <button type="button" onclick="removeDocuments()" class="btn ghost remove-btn" style="display: none;">❌ Hapus Semua</button>
            </div>
          </div>
        </div>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Cerita tambahan tentang bukti-bukti ini 💬</label>
          <textarea name="additional_info" rows="3" maxlength="500" placeholder="Misal: Foto ini diambil saat kejadian, video ini menunjukkan..." style="margin-top: 6px;"></textarea>
        </div>
      </div>

      <!-- Step 3.5: Tanda Tangan Digital -->
      <div class="card mt-16" style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); border: none; padding: 20px 22px;">
        <h3 style="margin-bottom: 8px; color: #3730a3; font-size: 18px;">✍️ Tanda Tangan Digital</h3>
        <p style="color: #4338ca; font-size: 13px; margin-bottom: 20px;">
          Buat tanda tangan digitalmu sebagai komitmen atas petisi ini! ✨
        </p>

        <div class="mt-12">
          <label style="font-weight: 500; color: #374151;">Tanda tangan kamu ✍️</label>
          <div style="font-size: 11px; color: var(--muted); margin-bottom: 8px;">Gambar tanda tangan di kotak biru di bawah ini</div>
          
          <div style="border: 2px dashed #38bdf8; border-radius: 12px; background: white; margin-top: 8px; position: relative;">
            <canvas id="signatureCanvas" width="300" height="150" style="display: block; width: 100%; max-width: 300px; height: 150px; cursor: crosshair; border-radius: 10px;"></canvas>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #9ca3af; font-size: 12px; pointer-events: none; text-align: center;" id="signaturePlaceholder">
              Gambar tanda tangan di sini
            </div>
          </div>
          
          <div style="display: flex; gap: 8px; margin-top: 12px;">
            <button type="button" onclick="clearSignature()" class="btn ghost" style="flex: 1; padding: 8px 16px; font-size: 14px;">
              🗑️ Hapus
            </button>
            <button type="button" onclick="saveSignature()" class="btn" style="flex: 1; background: #38bdf8; color: white; border: none; padding: 8px 16px; font-size: 14px;">
              💾 Simpan
            </button>
          </div>
          
          <div id="signaturePreview" style="display: none; margin-top: 12px; padding: 12px; background: rgba(99, 102, 241, 0.1); border-radius: 8px;">
            <div style="font-size: 12px; color: #4338ca; margin-bottom: 8px;">✅ Tanda tangan tersimpan:</div>
            <img id="signatureImage" style="max-width: 150px; border: 1px solid #d1d5db; border-radius: 4px;">
          </div>
        </div>
      </div>

      <!-- Step 4: Konfirmasi -->
      <div class="card mt-16" style="background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%); border: none; padding: 20px 22px;">
        <h3 style="margin-bottom: 8px; color: #991b1b; font-size: 18px;">✋ Tunggu Dulu!</h3>
        <p style="color: #dc2626; font-size: 13px; margin-bottom: 20px;">
          Sebelum kirim, pastikan kamu setuju dengan hal-hal ini ya 👇
        </p>
        
        <div class="mt-12">
          <label style="display: flex; align-items: flex-start; gap: 12px; cursor: pointer; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 8px; margin-bottom: 12px;">
            <input type="checkbox" name="fact_declaration" required style="margin-top: 4px; transform: scale(1.2);">
            <span style="font-size: 14px; line-height: 1.5;">
              ✅ Semua yang aku ceritakan adalah <strong>benar</strong> dan bukan karena dendam pribadi
            </span>
          </label>
        </div>

        <div class="mt-12">
          <label style="display: flex; align-items: flex-start; gap: 12px; cursor: pointer; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 8px; margin-bottom: 12px;">
            <input type="checkbox" name="responsibility" required style="margin-top: 4px; transform: scale(1.2);">
            <span style="font-size: 14px; line-height: 1.5;">
              ⚖️ Aku siap bertanggung jawab kalau ternyata ada yang salah
            </span>
          </label>
        </div>

        <div class="mt-12">
          <label style="display: flex; align-items: flex-start; gap: 12px; cursor: pointer; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 8px; margin-bottom: 12px;">
            <input type="checkbox" name="privacy_consent" required style="margin-top: 4px; transform: scale(1.2);">
            <span style="font-size: 14px; line-height: 1.5;">
              🔒 Data pribadiku boleh diverifikasi untuk memastikan petisi ini asli
            </span>
          </label>
        </div>

        <div class="mt-12">
          <label style="display: flex; align-items: flex-start; gap: 12px; cursor: pointer; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 8px;">
            <input type="checkbox" name="terms_agreement" required style="margin-top: 4px; transform: scale(1.2);">
            <span style="font-size: 14px; line-height: 1.5;">
              📋 Aku setuju dengan <a href="#" style="color: #dc2626; text-decoration: underline;">aturan main</a> SpeakUp!
            </span>
          </label>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="mt-20" style="margin-bottom: 40px; text-align: center;">
        <button type="submit" class="btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; width: 100%; padding: 18px; font-size: 18px; font-weight: 600; border-radius: 12px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
          🚀 Kirim Petisiku!
        </button>
        <p style="margin-top: 12px; font-size: 12px; color: var(--muted);">
          Tim kami akan review dalam 1-3 hari kerja 📝
        </p>
        <p style="margin-top: 4px; font-size: 11px; color: var(--muted);">
          Kamu akan dapat notifikasi lewat email ya! 📧
        </p>
      </div>
    </form>
  </main>

  <script src="assets/js/app.js"></script>
  
  <script>
    // File upload handlers
    function removeKTP() {
      const ktpUpload = document.getElementById('ktpUpload');
      const ktpPreview = document.getElementById('ktpPreview');
      const ktpImg = document.getElementById('ktpImg');
      
      ktpUpload.value = '';
      ktpPreview.style.display = 'none';
      ktpImg.src = '';
    }

    function removePhotos() {
      const photosUpload = document.getElementById('evidencePhotos');
      const photosList = document.getElementById('photosList');
      const removeBtn = document.querySelector('#photosPreview .remove-btn');
      
      photosUpload.value = '';
      photosList.innerHTML = '';
      removeBtn.style.display = 'none';
    }

    function removeVideo() {
      const videoUpload = document.getElementById('evidenceVideo');
      const videoPreview = document.getElementById('videoPreview');
      
      videoUpload.value = '';
      videoPreview.style.display = 'none';
      videoPreview.innerHTML = `
        <video id="videoElement" controls style="max-width: 100%; display: none; border-radius: 8px; margin-top: 8px;"></video>
        <button type="button" onclick="removeVideo()" class="btn ghost remove-btn" style="display: none;">❌ Hapus Video</button>
      `;
    }

    function removeDocuments() {
      const docsUpload = document.getElementById('documents');
      const documentsPreview = document.getElementById('documentsPreview');
      
      docsUpload.value = '';
      documentsPreview.style.display = 'none';
      documentsPreview.innerHTML = `
        <div id="documentsList"></div>
        <button type="button" onclick="removeDocuments()" class="btn ghost remove-btn" style="display: none;">❌ Hapus Semua</button>
      `;
    }

    // Function to show video in modal
    function showVideoModal(videoUrl, fileName) {
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px;';
      
      const modalContent = document.createElement('div');
      modalContent.style.cssText = 'background: white; border-radius: 12px; padding: 20px; max-width: 90vw; max-height: 90vh;';
      
      modalContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 16px;">
          <h3 style="margin: 0; color: #1e293b;">🎥 ${fileName}</h3>
        </div>
        <video controls style="max-width: 100%; max-height: 70vh; border-radius: 8px;">
          <source src="${videoUrl}" type="video/mp4">
          Browser Anda tidak mendukung video.
        </video>
        <div style="text-align: center; margin-top: 16px;">
          <button onclick="closeVideoModal()" class="btn ghost">Tutup</button>
        </div>
      `;
      
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
      window.currentVideoModal = modal;
      
      // Close on background click
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          closeVideoModal();
        }
      });
    }

    function closeVideoModal() {
      if (window.currentVideoModal) {
        document.body.removeChild(window.currentVideoModal);
        window.currentVideoModal = null;
      }
    }

    // Function to show document info
    function showDocumentInfo(file, extension, iconEmoji, iconColor) {
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px;';
      
      const modalContent = document.createElement('div');
      modalContent.style.cssText = 'background: white; border-radius: 12px; padding: 24px; max-width: 400px; width: 100%;';
      
      // Get file type description
      let fileTypeDesc = 'Dokumen';
      let fileTypeDetail = 'File dokumen umum';
      if (extension === 'PDF') {
        fileTypeDesc = 'PDF Document';
        fileTypeDetail = 'Portable Document Format - dapat dibuka di semua perangkat';
      } else if (extension === 'DOC' || extension === 'DOCX') {
        fileTypeDesc = 'Word Document';
        fileTypeDetail = 'Microsoft Word document - untuk teks dan formatting';
      } else if (extension === 'XLS' || extension === 'XLSX') {
        fileTypeDesc = 'Excel Spreadsheet';
        fileTypeDetail = 'Microsoft Excel spreadsheet - untuk data dan kalkulasi';
      } else if (extension === 'PPT' || extension === 'PPTX') {
        fileTypeDesc = 'PowerPoint Presentation';
        fileTypeDetail = 'Microsoft PowerPoint presentation - untuk slide presentasi';
      }
      
      const lastModified = new Date(file.lastModified).toLocaleDateString('id-ID', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      modalContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px;">
          <div style="width: 64px; height: 64px; background: ${iconColor}; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold; margin: 0 auto 12px;">
            <div style="font-size: 24px; margin-bottom: 4px;">${iconEmoji}</div>
            <div>${extension}</div>
          </div>
          <h3 style="margin: 0; color: #1e293b; font-size: 16px;">Informasi Dokumen</h3>
        </div>
        
        <div style="space-y: 12px;">
          <div style="margin-bottom: 12px;">
            <div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">Nama File:</div>
            <div style="font-weight: 500; color: #374151; word-break: break-all;">${file.name}</div>
          </div>
          
          <div style="margin-bottom: 12px;">
            <div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">Tipe File:</div>
            <div style="font-weight: 500; color: #374151;">${fileTypeDesc}</div>
            <div style="font-size: 11px; color: var(--muted);">${fileTypeDetail}</div>
          </div>
          
          <div style="margin-bottom: 12px;">
            <div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">Ukuran File:</div>
            <div style="font-weight: 500; color: #374151;">${(file.size / 1024).toFixed(1)} KB</div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">Terakhir Dimodifikasi:</div>
            <div style="font-weight: 500; color: #374151;">${lastModified}</div>
          </div>
        </div>
        
        <div style="text-align: center;">
          <button onclick="closeDocumentModal()" class="btn primary" style="padding: 10px 20px;">Tutup</button>
        </div>
      `;
      
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
      window.currentDocumentModal = modal;
      
      // Close on background click
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          closeDocumentModal();
        }
      });
    }

    function closeDocumentModal() {
      if (window.currentDocumentModal) {
        document.body.removeChild(window.currentDocumentModal);
        window.currentDocumentModal = null;
      }
    }

    // KTP upload preview
    document.getElementById('ktpUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const ktpImg = document.getElementById('ktpImg');
          const ktpPreview = document.getElementById('ktpPreview');
          ktpImg.src = e.target.result;
          ktpPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // Evidence photos upload preview
    document.getElementById('evidencePhotos').addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      const photosList = document.getElementById('photosList');
      const removeBtn = document.querySelector('#photosPreview .remove-btn');
      const photosPreview = document.getElementById('photosPreview');
      
      if (files.length > 5) {
        alert('Maksimal 5 foto yang dapat diupload');
        e.target.value = '';
        return;
      }
      
      photosList.innerHTML = '';
      
      if (files.length > 0) {
        // Show file names and thumbnails
      files.forEach((file, index) => {
          const fileItem = document.createElement('div');
          fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(16, 185, 129, 0.1); border-radius: 6px; margin: 4px 0; border-left: 3px solid #10b981;';
          
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement('img');
          img.src = e.target.result;
            img.style.cssText = 'width: 40px; height: 40px; object-fit: cover; border-radius: 4px; border: 1px solid #d1d5db;';
            
            const fileInfo = document.createElement('div');
            fileInfo.style.cssText = 'flex: 1; font-size: 12px;';
            fileInfo.innerHTML = `
              <div style="font-weight: 500; color: #047857;">📷 ${file.name}</div>
              <div style="color: var(--muted);">${(file.size / 1024).toFixed(1)} KB</div>
            `;
            
            fileItem.appendChild(img);
            fileItem.appendChild(fileInfo);
            photosList.appendChild(fileItem);
        };
        reader.readAsDataURL(file);
      });
      
        photosPreview.style.display = 'block';
        removeBtn.style.display = 'block';
      } else {
        photosPreview.style.display = 'none';
      }
    });

    // Video upload preview
    document.getElementById('evidenceVideo').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const videoElement = document.getElementById('videoElement');
      const removeBtn = document.querySelector('#videoPreview .remove-btn');
      const videoPreview = document.getElementById('videoPreview');
      
      if (file) {
        if (file.size > 50 * 1024 * 1024) { // 50MB limit
          alert('Ukuran video maksimal 50MB');
          e.target.value = '';
          return;
        }
        
        // Clear previous content
        videoPreview.innerHTML = '';
        
        // Create main container
        const videoContainer = document.createElement('div');
        videoContainer.style.cssText = 'display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 3px solid #10b981;';
        
        // Create video thumbnail container
        const thumbnailContainer = document.createElement('div');
        thumbnailContainer.style.cssText = 'flex-shrink: 0;';
        
        const url = URL.createObjectURL(file);
        const video = document.createElement('video');
        video.src = url;
        video.style.cssText = 'width: 80px; height: 60px; object-fit: cover; border-radius: 6px; border: 1px solid #d1d5db;';
        video.muted = true;
        
        // Create play icon overlay
        const playIcon = document.createElement('div');
        playIcon.style.cssText = 'position: relative; display: inline-block;';
        playIcon.innerHTML = `
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">▶</div>
        `;
        playIcon.appendChild(video);
        thumbnailContainer.appendChild(playIcon);
        
        // Load video metadata to get thumbnail
        video.addEventListener('loadedmetadata', function() {
          video.currentTime = 1; // Seek to 1 second for thumbnail
        });
        
        // Create file info
        const fileInfo = document.createElement('div');
        fileInfo.style.cssText = 'flex: 1; min-width: 0;';
        fileInfo.innerHTML = `
          <div style="font-weight: 500; color: #047857; font-size: 13px; margin-bottom: 4px;">🎥 ${file.name}</div>
          <div style="color: var(--muted); font-size: 11px; margin-bottom: 4px;">${(file.size / (1024 * 1024)).toFixed(1)} MB</div>
          <div style="color: var(--muted); font-size: 10px;">Klik untuk memutar video</div>
        `;
        
        // Add click handler to show full video
        thumbnailContainer.addEventListener('click', function() {
          showVideoModal(url, file.name);
        });
        thumbnailContainer.style.cursor = 'pointer';
        
        videoContainer.appendChild(thumbnailContainer);
        videoContainer.appendChild(fileInfo);
        videoPreview.appendChild(videoContainer);
        
        // Add remove button
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.onclick = removeVideo;
        removeBtn.className = 'btn ghost remove-btn';
        removeBtn.style.cssText = 'margin-top: 8px; width: 100%;';
        removeBtn.textContent = '❌ Hapus Video';
        videoPreview.appendChild(removeBtn);
        
        videoPreview.style.display = 'block';
      }
    });

    // Documents upload preview
    document.getElementById('documents').addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      const docsList = document.getElementById('documentsList');
      const removeBtn = document.querySelector('#documentsPreview .remove-btn');
      const documentsPreview = document.getElementById('documentsPreview');
      
      if (files.length > 3) {
        alert('Maksimal 3 dokumen yang dapat diupload');
        e.target.value = '';
        return;
      }
      
      docsList.innerHTML = '';
      
      if (files.length > 0) {
      files.forEach((file, index) => {
        const fileDiv = document.createElement('div');
          fileDiv.style.cssText = 'display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin: 8px 0; border-left: 3px solid #10b981; cursor: pointer; transition: all 0.2s;';
          
          // Create file icon with better styling
          const fileIcon = document.createElement('div');
          const extension = file.name.split('.').pop().toUpperCase();
          let iconColor = '#10b981';
          let iconEmoji = '📄';
          
          // Different colors and icons for different file types
          if (extension === 'PDF') {
            iconColor = '#dc2626';
            iconEmoji = '📕';
          } else if (extension === 'DOC' || extension === 'DOCX') {
            iconColor = '#2563eb';
            iconEmoji = '📘';
          } else if (extension === 'XLS' || extension === 'XLSX') {
            iconColor = '#059669';
            iconEmoji = '📗';
          } else if (extension === 'PPT' || extension === 'PPTX') {
            iconColor = '#ea580c';
            iconEmoji = '📙';
          }
          
          fileIcon.style.cssText = `width: 48px; height: 48px; background: ${iconColor}; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; flex-shrink: 0;`;
          fileIcon.innerHTML = `
            <div style="font-size: 16px; margin-bottom: 2px;">${iconEmoji}</div>
            <div>${extension}</div>
          `;
          
          const fileInfo = document.createElement('div');
          fileInfo.style.cssText = 'flex: 1; min-width: 0;';
          
          // Get file type description
          let fileTypeDesc = 'Dokumen';
          if (extension === 'PDF') fileTypeDesc = 'PDF Document';
          else if (extension === 'DOC' || extension === 'DOCX') fileTypeDesc = 'Word Document';
          else if (extension === 'XLS' || extension === 'XLSX') fileTypeDesc = 'Excel Spreadsheet';
          else if (extension === 'PPT' || extension === 'PPTX') fileTypeDesc = 'PowerPoint Presentation';
          
          fileInfo.innerHTML = `
            <div style="font-weight: 500; color: #047857; font-size: 13px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">📄 ${file.name}</div>
            <div style="color: var(--muted); font-size: 11px; margin-bottom: 2px;">${fileTypeDesc}</div>
            <div style="color: var(--muted); font-size: 10px;">${(file.size / 1024).toFixed(1)} KB • Klik untuk info lebih</div>
          `;
          
          // Add hover effect
          fileDiv.addEventListener('mouseenter', function() {
            this.style.background = 'rgba(16, 185, 129, 0.15)';
            this.style.transform = 'translateY(-1px)';
          });
          
          fileDiv.addEventListener('mouseleave', function() {
            this.style.background = 'rgba(16, 185, 129, 0.1)';
            this.style.transform = 'translateY(0)';
          });
          
          // Add click handler to show file info
          fileDiv.addEventListener('click', function() {
            showDocumentInfo(file, extension, iconEmoji, iconColor);
          });
          
          fileDiv.appendChild(fileIcon);
          fileDiv.appendChild(fileInfo);
        docsList.appendChild(fileDiv);
      });
      
        documentsPreview.style.display = 'block';
        removeBtn.style.display = 'block';
      } else {
        documentsPreview.style.display = 'none';
      }
    });

    // Form submission
    document.getElementById('createPetitionForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      
      // Validation
      const requiredFields = ['title', 'description', 'target', 'solution', 'category', 'full_name', 'nik', 'phone', 'email'];
      const missingFields = requiredFields.filter(field => !formData.get(field));
      
      if (missingFields.length > 0) {
        alert('Mohon lengkapi semua field yang wajib diisi');
        return;
      }
      
      if (!formData.get('ktp')) {
        alert('Upload foto KTP wajib dilakukan');
        return;
      }
      
      // Show petition preview
      showPetitionPreview(formData);
    });

    function showPetitionPreview(formData) {
      // Create modal for preview
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;';
      
      const modalContent = document.createElement('div');
      modalContent.style.cssText = 'background: white; border-radius: 12px; max-width: 600px; max-height: 80vh; overflow-y: auto; width: 100%;';
      
      const today = new Date();
      const dateStr = today.toLocaleDateString('id-ID', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      
      modalContent.innerHTML = `
        <div style="padding: 24px;">
          <div style="text-align: center; margin-bottom: 24px;">
            <h2 style="color: #1e293b; margin-bottom: 8px;">📋 Preview Petisi</h2>
            <p style="color: var(--muted); font-size: 14px;">Pastikan semua informasi sudah benar sebelum dikirim</p>
          </div>
          
          <div style="background: #f8fafc; border: 1px solid var(--border); border-radius: 8px; padding: 24px; font-family: 'Times New Roman', serif;">
            <div style="text-align: center; margin-bottom: 24px;">
              <h3 style="margin: 0; font-size: 16px; font-weight: 600;">PETISI MASYARAKAT</h3>
              <p style="margin: 4px 0; font-size: 14px;">${formData.get('title')}</p>
              <p style="margin: 4px 0; font-size: 12px; color: var(--muted);">${dateStr}</p>
            </div>
            
            <div style="margin-bottom: 16px;">
              <p><strong>Kepada Yth.</strong><br>
              ${formData.get('target')}</p>
            </div>
            
            <div style="line-height: 1.6; margin-bottom: 24px;">
              <p>Dengan hormat,</p>
              
              <p>Saya, ${formData.get('full_name')}, dengan ini menyampaikan petisi terkait masalah berikut:</p>
              
              <p><strong>Deskripsi Masalah:</strong><br>
              ${formData.get('description')}</p>
              
              <p><strong>Solusi yang Diharapkan:</strong><br>
              ${formData.get('solution')}</p>
              
              ${formData.get('additional_info') ? `<p><strong>Informasi Tambahan:</strong><br>${formData.get('additional_info')}</p>` : ''}
              
              <p>Demikian petisi ini saya sampaikan dengan harapan dapat ditindaklanjuti segera.</p>
              
              <p>Hormat saya,<br>
              <strong>${formData.get('full_name')}</strong><br>
              ${formData.get('phone')} | ${formData.get('email')}</p>
            </div>
            
            ${signatureData ? `
            <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
              <p style="font-size: 12px; color: var(--muted); margin-bottom: 8px;">Tanda Tangan Digital:</p>
              <img src="${signatureData}" style="max-width: 150px; border: 1px solid var(--border); border-radius: 4px;">
            </div>
            ` : ''}
          </div>
          
          <div style="margin-top: 24px; display: flex; gap: 12px;">
            <button onclick="closePetitionPreview()" class="btn ghost" style="flex: 1; padding: 12px;">
              ← Kembali Edit
            </button>
            <button onclick="submitPetition()" class="btn primary" style="flex: 1; padding: 12px; background: #10b981; color: white; border: none;">
              🚀 Kirim Petisi!
            </button>
          </div>
        </div>
      `;
      
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
      
      // Store modal reference
      window.currentModal = modal;
    }

    function closePetitionPreview() {
      if (window.currentModal) {
        document.body.removeChild(window.currentModal);
        window.currentModal = null;
      }
    }

    function submitPetition() {
      closePetitionPreview();
      
      // Mock submission
      alert('🎉 Yeay! Petisimu berhasil dikirim!\n\n📝 Tim kami akan review petisimu dalam 1-3 hari kerja\n📧 Kamu akan dapat notifikasi lewat email\n\n✊ Terima kasih sudah berani speak up! Bersama kita bisa buat perubahan!');
      
      // Redirect back to petitions page
      window.location.href = './petitions.html';
    }

    // NIK input validation
    document.querySelector('input[name="nik"]').addEventListener('input', function(e) {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });

    // Phone input validation
    document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });

    // Digital Signature functionality
    let isDrawing = false;
    let signatureData = null;
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    const placeholder = document.getElementById('signaturePlaceholder');

    // Set canvas size properly
    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * 2; // High DPI
      canvas.height = rect.height * 2;
      ctx.scale(2, 2);
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.strokeStyle = '#1f2937';
      ctx.lineWidth = 2;
    }

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Mouse events
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // Touch events for mobile
    canvas.addEventListener('touchstart', handleTouch);
    canvas.addEventListener('touchmove', handleTouch);
    canvas.addEventListener('touchend', stopDrawing);

    function startDrawing(e) {
      isDrawing = true;
      placeholder.style.display = 'none';
      const rect = canvas.getBoundingClientRect();
      ctx.beginPath();
      ctx.moveTo(
        (e.clientX - rect.left) * (canvas.width / rect.width) / 2,
        (e.clientY - rect.top) * (canvas.height / rect.height) / 2
      );
    }

    function draw(e) {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      ctx.lineTo(
        (e.clientX - rect.left) * (canvas.width / rect.width) / 2,
        (e.clientY - rect.top) * (canvas.height / rect.height) / 2
      );
      ctx.stroke();
    }

    function stopDrawing() {
      isDrawing = false;
      ctx.beginPath();
    }

    function handleTouch(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                       e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      canvas.dispatchEvent(mouseEvent);
    }

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      placeholder.style.display = 'block';
      document.getElementById('signaturePreview').style.display = 'none';
      signatureData = null;
    }

    function saveSignature() {
      if (isCanvasEmpty()) {
        alert('Mohon buat tanda tangan terlebih dahulu! ✍️');
        return;
      }
      
      signatureData = canvas.toDataURL('image/png');
      document.getElementById('signatureImage').src = signatureData;
      document.getElementById('signaturePreview').style.display = 'block';
      
      // Show success message
      const preview = document.getElementById('signaturePreview');
      preview.style.background = 'rgba(34, 197, 94, 0.1)';
      preview.style.borderLeft = '4px solid #22c55e';
      
      setTimeout(() => {
        preview.style.background = 'rgba(99, 102, 241, 0.1)';
        preview.style.borderLeft = 'none';
      }, 2000);
    }

    function isCanvasEmpty() {
      const blank = document.createElement('canvas');
      blank.width = canvas.width;
      blank.height = canvas.height;
      return canvas.toDataURL() === blank.toDataURL();
    }

    // Update form validation to include signature
    const originalFormHandler = document.getElementById('createPetitionForm').onsubmit;
    document.getElementById('createPetitionForm').addEventListener('submit', function(e) {
      if (!signatureData) {
        e.preventDefault();
        alert('Mohon buat tanda tangan digital terlebih dahulu! ✍️');
        document.getElementById('signatureCanvas').scrollIntoView({ behavior: 'smooth' });
        return false;
      }
    });
  </script>

  <!-- Navigation -->
  <nav class="bottom-nav" aria-label="Navigasi bawah">
    <div class="inner">
      <a href="./index.html" title="Home">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
        </svg>
      </a>
      <a href="./timeline.html" title="Timeline">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
        </svg>
      </a>
      <button class="btn plus-btn" data-open-create title="Speak!">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
        </svg>
      </button>
      <a href="./petitions.html" class="active" title="Petitions">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
        </svg>
      </a>
      <a href="./profile.html" title="Profile">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
        </svg>
      </a>
    </div>
  </nav>
        </main>
        
        <!-- Home indicator -->
        <div class="home-indicator"></div>
      </div>
    </div>
  </div>
</body>
</html>
